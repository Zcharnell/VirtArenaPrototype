function Ability(initVars){this.name="",this.type="",this.cost=0,this.desc="",this.user="",this.target="";var keys=Object.keys(initVars);for(var i in keys)this[keys[i]]=initVars[keys[i]]}function Avatar(obj){this.x=0,this.y=0,this.width=70,this.height=70,this.text="",this.unit="",this.hover=!1,this.selected=!1,this.activating=!1;for(var keys=Object.keys(obj),i=0;i<keys.length;i++)this[keys[i]]=obj[keys[i]];this.draw=function(){VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.font="16px Arial",VirtArenaControl.Graphics.ctx.fillStyle="#333333",VirtArenaControl.Graphics.ctx.strokeStyle="#000000",VirtArenaControl.Graphics.ctx.fillRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.strokeRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.fillStyle="#FFFFFF",VirtArenaControl.Graphics.ctx.fillText(this.text,this.x+this.width/2,this.y+this.height/2),this.activating&&(VirtArenaControl.Graphics.ctx.strokeStyle="rgb(50,255,50)",VirtArenaControl.Graphics.strokeRectWithShadow(this.x,this.y,this.width+2,this.height+2,2,"rgba(50,255,50,0.7)",20,0,1)),this.selected&&(VirtArenaControl.Graphics.ctx.strokeStyle="rgb(200,220,255)",VirtArenaControl.Graphics.strokeRectWithShadow(this.x,this.y,this.width+2,this.height+2,2,"rgba(200,220,255,0.7)",20,0,1)),this.hover&&(VirtArenaControl.Graphics.ctx.strokeStyle="rgb(150,170,200)",VirtArenaControl.Graphics.strokeRectWithShadow(this.x,this.y,this.width+2,this.height+2,2,"rgba(150,170,200,0.7)",20,0,1));var xBar=this.x+Math.floor(.05*this.width),widthBar=Math.floor(.95*this.width),widthBarHealth=Math.floor(.95*this.width*(this.unit.percentHP/100));VirtArenaControl.Graphics.ctx.fillStyle="#EE0000",VirtArenaControl.Graphics.ctx.strokeStyle="#000000",VirtArenaControl.Graphics.ctx.fillRect(xBar,this.y-5,widthBar,10),VirtArenaControl.Graphics.ctx.fillStyle="#00EE00",VirtArenaControl.Graphics.ctx.fillRect(xBar,this.y-5,widthBarHealth,10),VirtArenaControl.Graphics.ctx.strokeRect(xBar,this.y-5,widthBar,10)},this.update=function(){this.activating=this.unit.id===VirtArenaControl.Units.currentUnitActivating.id?!0:!1,this.selected=this.unit.id===VirtArenaControl.Units.selectedUnit.id?!0:!1,this.hover=this.unit.tile.hover===!0||VirtArenaControl.Updater.hoveredObjects.indexOf(this)>-1?!0:!1,this.x=VirtArenaControl.Board.x+5,this.y=VirtArenaControl.Board.y+VirtArenaControl.Board.topPadding/2+85*this.unit.activationOrderIndex,this.text=this.unit.name},this.onClick=function(){VirtArenaControl.ObjectController.selectUnit(this.unit)}}function Button(){this.x=0,this.y=0,this.width=100,this.height=40,this.text="",this.circle=!1,this.hover=!1,this.hoverVars={x:0,y:0,radius:0,maxRadius:0},this.selectedVars={x:0,y:0,radius:0,maxRadius:0},this.selected=!1,this.hasTooltip=!1,this.init=function(obj){for(var keys=Object.keys(obj),i=0;i<keys.length;i++)this[keys[i]]=obj[keys[i]]},this.draw=function(){this.disabled?this.drawShape("#444444","#000000","#CCCCCC","12px Arial"):this.selected?this.drawShape("#FFFFFF","#000000","#000000","12px Arial",this.selectedVars):this.hover?this.drawShape("#CCCCCC","#000000","#000000","12px Arial",this.hoverVars):this.drawShape("#666666","#000000","#FFFFFF","12px Arial")},this.drawShape=function(fillColor,strokeColor,textColor,font,misc){this.circle?this.drawCircle(fillColor,strokeColor,textColor,font,misc):this.drawRect(fillColor,strokeColor,textColor,font,misc)},this.drawRect=function(fillColor,strokeColor,textColor,font,misc){VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.font=font,VirtArenaControl.Graphics.ctx.fillStyle=fillColor,VirtArenaControl.Graphics.ctx.strokeStyle=strokeColor,VirtArenaControl.Graphics.ctx.fillRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.strokeRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.fillStyle=textColor,VirtArenaControl.Graphics.ctx.fillText(this.text,this.x+this.width/2,this.y+this.height/2)},this.drawCircle=function(fillColor,strokeColor,textColor,font,misc){var misc=misc||{};VirtArenaControl.Graphics.ctx.fillStyle=fillColor,VirtArenaControl.Graphics.ctx.strokeStyle=strokeColor;var radius=misc.radius||this.radius;if(VirtArenaControl.Graphics.ctx.beginPath(),VirtArenaControl.Graphics.ctx.arc(this.x+this.radius,this.y+this.radius,radius,0,2*Math.PI,!1),this.image){var image=this.hover||this.selected?this.imageHover:this.image;VirtArenaControl.Graphics.ctx.drawImage(image,this.x+this.radius-radius,this.y+this.radius-radius,2*radius,2*radius),this.hover||this.selected||VirtArenaControl.Graphics.ctx.stroke(),this.disabled&&(VirtArenaControl.Graphics.ctx.globalAlpha=.5,VirtArenaControl.Graphics.ctx.fillColor="rgba(0,0,0,0.4)",VirtArenaControl.Graphics.ctx.fill(),VirtArenaControl.Graphics.ctx.globalAlpha=1)}else VirtArenaControl.Graphics.ctx.fill(),VirtArenaControl.Graphics.ctx.stroke()},this.onClick={},this.getTooltip=function(){return!1}}function Unit(){this.setStartingVars=function(){this.HP=200,this.totalHP=200,this.previousHP=200,this.percentHP=100,this.energy=90,this.energyExtra=30,this.name="",this.unitType="",this.unitClass="",this.commander=!1,this.alive=!0,this.weapons={},this.stances={},this.stanceSelected="",this.lastStanceSelected="",this.weaponSelected={},this.team={},this.activated=!1,this.id="",this.activationOrderIndex=0,this.hasAttacked=!1,this.abilitiesActive=[],this.defenseAbilities=[],this.tile={},this.avatar={},this.dontDraw=!1,this.direction=0,this.font="30px Arial",this.animation={time:0,frame:0,current:""},this.animation.current="idle",this.animation.idle={frames:4,duration:6,yIndex:0},this.animation.move={frames:4,duration:4,yIndex:2},this.animationTime=0,this.animationFrame=0,this.animationDuration=5,this.energy=90,this.energyExtra=30,this.capacityLimit=0,this.capacity=0,this.supply=0,this.ai={hasMoved:!1,hasUsedCards:!1,hasAttacked:!1},this.turnStats={speed:0,move:0,defense:0,evasion:0,stability:0,deflect:0,power:0,range:0,penetration:0,impact:0,deflect:0,rapidFire:0,vampiric:!1,attackVulnerability:0,attackWeakness:0,attackSlow:!1,attackDisable:0,vulnerability:0,weakness:0,slow:0,slowUsed:!1,disable:0,resilience:-1,attackBlast:!1,attackLineOfFire:!1,isStunned:!1,stunnedThisAttack:!1,stunnedThisTurn:!1,movedThisTurn:!1,moveRangeLeast:0,moveRangeMax:0,hasActivated:!1,isVersatile:!1,attackBeforeMove:!1}},this.draw=function(){if(this.id===VirtArenaControl.Units.selectedUnit.id){VirtArenaControl.Graphics.ctx.textAlign="left",VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.strokeStyle="white",VirtArenaControl.Graphics.strokeRectWithShadow(this.tile.x,this.tile.y,this.tile.width,this.tile.height,2,"#ffffff",2,0,1),VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.font=this.font,VirtArenaControl.Graphics.ctx.fillStyle="#FFFFFF",VirtArenaControl.Graphics.ctx.strokeStyle=this.team.color,VirtArenaControl.Graphics.ctx.strokeRect(this.tile.x,this.tile.y,this.tile.width,this.tile.height);var fillText={text:this.name[0],x:this.tile.x+this.tile.width/2,y:this.tile.y+this.tile.height/2,color:this.team.color,blur:5,offsetX:0,offsetY:1};if(this.unitArt){var spritesheet=VirtArenaControl.Images.spritesheet,paddingX=Math.floor((this.tile.width-spritesheet.cellWidth)/2),paddingY=Math.floor((this.tile.height-spritesheet.cellHeight)/2);VirtArenaControl.Graphics.ctx.drawImage(spritesheet.image,this.unitArt.x+this.animation.frame*spritesheet.cellWidth,this.unitArt.y+(this.animation[this.animation.current].yIndex+this.direction)*spritesheet.cellHeight,spritesheet.cellWidth,spritesheet.cellHeight,this.tile.x+paddingX,this.tile.y+paddingY,spritesheet.cellWidth,spritesheet.cellHeight)}else VirtArenaControl.Graphics.fillTextWithShadow(fillText.text,fillText.x,fillText.y,fillText.color,fillText.blur,fillText.offsetX,fillText.offsetY),VirtArenaControl.Graphics.ctx.strokeStyle="#999",VirtArenaControl.Graphics.ctx.lineWidth=1,VirtArenaControl.Graphics.ctx.strokeText(fillText.text,fillText.x,fillText.y)}else{VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.font=this.font,VirtArenaControl.Graphics.ctx.fillStyle=this.team.color,VirtArenaControl.Graphics.ctx.strokeStyle=this.team.color,VirtArenaControl.Graphics.ctx.strokeRect(this.tile.x,this.tile.y,this.tile.width,this.tile.height);var fillText={text:this.name[0],x:this.tile.x+this.tile.width/2,y:this.tile.y+this.tile.height/2,color:"#9F9F9F",blur:5,offsetX:0,offsetY:1};if(this.unitArt){var spritesheet=VirtArenaControl.Images.spritesheet,paddingX=Math.floor((this.tile.width-spritesheet.cellWidth)/2),paddingY=Math.floor((this.tile.height-spritesheet.cellHeight)/2);VirtArenaControl.Graphics.ctx.drawImage(spritesheet.image,this.unitArt.x+this.animation.frame*spritesheet.cellWidth,this.unitArt.y+(this.animation[this.animation.current].yIndex+this.direction)*spritesheet.cellHeight,spritesheet.cellWidth,spritesheet.cellHeight,this.tile.x+paddingX,this.tile.y+paddingY,spritesheet.cellWidth,spritesheet.cellHeight)}else VirtArenaControl.Graphics.fillTextWithShadow(fillText.text,fillText.x,fillText.y,fillText.color,fillText.blur,fillText.offsetX,fillText.offsetY),VirtArenaControl.Graphics.ctx.strokeStyle="#999",VirtArenaControl.Graphics.ctx.lineWidth=1,VirtArenaControl.Graphics.ctx.strokeText(fillText.text,fillText.x,fillText.y)}if(this.commander){VirtArenaControl.Graphics.ctx.textAlign="right",VirtArenaControl.Graphics.ctx.textBaseline="top",VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.fillStyle="#FFFFFF";var text=String.fromCharCode(9733);VirtArenaControl.Graphics.ctx.fillText(text,this.tile.x+this.tile.width-2,this.tile.y+2),VirtArenaControl.Graphics.ctx.textBaseline="middle"}this.drawHP()},this.drawHP=function(){VirtArenaControl.Graphics.ctx.strokeStyle="#000000",VirtArenaControl.Graphics.ctx.fillStyle="#EE0000",VirtArenaControl.Graphics.ctx.fillRect(this.tile.x,this.tile.y-5,this.tile.width,8),VirtArenaControl.Graphics.ctx.fillStyle="#00EE00",VirtArenaControl.Graphics.ctx.fillRect(this.tile.x,this.tile.y-5,Math.floor(this.tile.width*(this.percentHP/100)),8),VirtArenaControl.Graphics.ctx.strokeRect(this.tile.x,this.tile.y-5,this.tile.width,8)},this.setDirection=function(direction){switch(direction){case"left":this.direction=0;break;case"right":this.direction=1}},this.setAnimation=function(animation){this.animation.current=animation,this.animation.time=0,this.animation.frame=0},this.checkCurrentAnimation=function(){this.moving?"move"!=this.animation.current&&this.setAnimation("move"):"idle"!=this.animation.current&&this.setAnimation("idle")},this.getTooltip=function(){var tooltip={};return tooltip.x=Math.floor(this.tile.x+this.tile.width/2),tooltip.y=this.tile.y,tooltip.type="unit",tooltip.id=this.id,tooltip.title=this.name,tooltip.subtitle=this.commander?"commander":"companion",tooltip.obj=this,tooltip},this.setCommander=function(){this.font="36px Arial",this.commander=!0},this.setStartingStance=function(){var keys=Object.keys(this.stances),stanceToChoose="";stanceToChoose=3===keys.length?2:keys.length;var stance=this.stances["stance"+stanceToChoose];keys=Object.keys(stance);for(var i in keys)this.turnStats[keys[i]]=stance[keys[i]];this.turnStats.slow>0&&(this.turnStats.speed-=this.turnStats.slow,this.turnStats.slowUsed=!0,this.turnStats.speed<0&&(this.turnStats.speed=0)),this.turnStats.disable>0&&(this.turnStats.move-=this.turnStats.disable,this.turnStats.move<0&&(this.turnStats.move=0))},this.setStance=function(stanceKey){var stance=this.stances[stanceKey],keys=Object.keys(stance);this.stanceSelected=stanceKey;for(var i in keys)this.turnStats[keys[i]]=stance[keys[i]];this.turnStats.slow>0&&(this.turnStats.speed-=this.turnStats.slow,this.turnStats.slowUsed=!0,this.turnStats.speed<0&&(this.turnStats.speed=0)),this.turnStats.disable>0&&(this.turnStats.move-=this.turnStats.disable,this.turnStats.move<0&&(this.turnStats.move=0)),this.turnStats.isStunned&&(this.turnStats.power-=10,this.turnStats.defense-=10),this.unitStanceAffectingVariables()},this.setWeapon=function(numWeapon){var weapon=this.weapons["weapon"+numWeapon],keys=Object.keys(weapon);for(var i in keys)this.weaponSelected[keys[i]]=weapon[keys[i]];this.turnStats["weapon"+numWeapon+"Used"]=!0,this.unitTypeSpecialValues()},this.getWeaponRange=function(){var range=0;if(this.weaponSelected.name)range=this.weaponSelected.range;else{var keys=Object.keys(this.weapons);for(var i in keys)range<this.weapons[keys[i]].range&&(range=this.weapons[keys[i]].range)}return range},this.getDamageAndStatsForAttacking=function(){var diceRolls=this.rollDamage(),penetration=this.weaponSelected.penetration,impact=this.weaponSelected.impact,obj={weapon:this.weaponSelected,damage:diceRolls.damage,critDamage:diceRolls.critDamage,damageDice:diceRolls.damageDice,critDice:diceRolls.critDice,penetration:penetration,impact:impact};return obj},this.rollDamage=function(){for(var power=this.weaponSelected.power+this.turnStats.power,diceRolls={damage:0,critDamage:0,damageDice:[],critDice:[]},i=0;power>i;i++){var roll=Scripts.rollDamageDie();roll.crit?(diceRolls.critDice.push(roll.roll),diceRolls.critDamage+=roll.roll):(diceRolls.damageDice.push(roll.roll),diceRolls.damage+=roll.roll)}return diceRolls},this.takeDamage=function(obj){var damage=obj.damage,critDamage=obj.critDamage,penetration=(obj.damageDice,obj.critDice,obj.penetration),tempDefense=(obj.impact,this.turnStats.defense);console.log("Attack: ",obj.weapon,obj," Defense: ",tempDefense),this.previousHP=this.HP;for(var defenseAbilitiesLength=this.defenseAbilities.length,i=0;defenseAbilitiesLength>i;i++)this.useDefenseAbility(this.defenseAbilities.shift);penetration>0&&(tempDefense-=penetration),0>tempDefense&&(tempDefense=0);var damageTaken=damage-tempDefense;0>damageTaken&&(damageTaken=0),damageTaken+=critDamage,damageTaken>0?this.HP-=damageTaken:damageTaken=0,this.takeStabilityDmg(damageTaken),console.log("PreviousHP:"+this.previousHP+"; NewHP: "+this.HP),this.percentHPBar(),this.HP<=0&&this.setDead()},this.takeStabilityDmg=function(damage){var tempStability=this.turnStats.stability,damageStabTaken=damage-tempStability;return damageStabTaken>0&&(this.turnStats.isStunned===!1&&(console.log(this.name+" Stunned!"),this.turnStats.isStunned=!0,this.turnStats.defense-=10,this.turnStats.power-=10),this.turnStats.stunThisTurn=!0),damageStabTaken},this.percentHPBar=function(){this.previousHP!=this.HP&&(this.previousHP=this.HP,this.percentHP=Math.round(this.HP/this.totalHP*100)),this.percentHP<0&&(this.percentHP=0)},this.setDead=function(){this.alive=!1,this.tile.resetUnit(),VirtArenaControl.ObjectController.unitHasDied(this)},this.canActivateThisTurn=function(){var canActivate=!0;return this.alive||(canActivate=!1),canActivate},this.addAttackAbility=function(ability){this.abilitiesActive.push(ability);var keys=ability.keys,values=ability.values;for(var i in keys)this.turnStats[keys[i]]+=values[i]},this.addDefenseAbility=function(ability){this.defenseAbilities.push(ability)},this.useDefenseAbility=function(ability){this.abilitiesActive.push(ability);var keys=ability.keys,values=ability.values;for(var i in keys)this.turnStats[keys[i]]+=values[i]},this.removeActivationAbilities=function(){for(var i in this.abilitiesActive)"attack"==this.abilitiesActive[i].type&&this.removeAbility(this.abilitiesActive[i])},this.removeAbility=function(ability){var keys=ability.keys,values=ability.values;for(var i in keys)this.turnStats[keys[i]]-=values[i];this.abilitiesActive.splice(this.abilitiesActive.indexOf(ability),1)},this.unitStanceAffectingVariables=function(){},this.unitTypeSpecialValues=function(){}}function Stance(initVars){this.name="",this.number=0,this.speed=0,this.move=0,this.defense=0,this.evasion=0,this.stability=0,this.deflect=0,this.versatile=!1,this.vampiric=!1,this.penetration=0,this.rapidFire=0,this.impact=0,this.dualWield=!1,this.precision=!1,this.reveal="none",this.misc="none",this.desc="";var keys=Object.keys(initVars);for(var i in keys)this[keys[i]]=initVars[keys[i]]}function Team(name,color,playerType){this.name=name,this.color=color,this.units=[],this.commander={},this.hasPriority=!1,this.deck="",this.aiTeam="ai"===playerType?!0:!1,console.log(this.aiTeam),this.addUnit=function(unit){unit.team=this,VirtArenaControl.ObjectController.addUnit(unit),this.units.push(unit)},this.addCompanion=function(unitName,tile){var unit=VirtArenaControl.ObjectController.getUnitObject(unitName);unit.direction=this.commander.direction,tile&&VirtArenaControl.ObjectController.setUnitTile(unit,tile),this.addUnit(unit)},this.addCommander=function(unitName){var unit=VirtArenaControl.ObjectController.getUnitObject(unitName);unit.setCommander(),this.commander=unit,this.addUnit(unit),this.addDeck()},this.addDeck=function(){this.deck=new Deck({commander:this.commander,team:this}),this.deck.shuffle(),this.deck.drawCardsStartOfGame()},this.setStartingPosition=function(positionObj){var commanderSet=!1,positions=Object.keys(positionObj);for(var i in this.units){if(this.units[i]!==this.commander||commanderSet){var tile=VirtArenaControl.Board.tiles[positionObj[positions[0]]];VirtArenaControl.ObjectController.setUnitTile(this.units[i],tile),positions.splice(0,1)}else{var tile=VirtArenaControl.Board.tiles[positionObj.commanderTile];VirtArenaControl.ObjectController.setUnitTile(this.units[i],tile),positions.splice(positions.indexOf("commanderTile"),1),commanderSet=!0}this.units[i].tile.column<=VirtArenaControl.Board.columns/2?this.units[i].setDirection("right"):this.units[i].setDirection("left")}},this.spawnUnitNearCommander=function(card,companion){VirtArenaControl.TurnController.setCurrentAction("spawnCompanion",{card:card,team:this,companion:companion})},this.cardUsed=function(card){var cardToDiscard=this.deck.cardsInHand.splice(card.positionInHand,1);this.deck.discardPile.push(cardToDiscard)},this.allStancesSelected=function(){for(var i in this.units)if(this.units[i].alive&&""===this.units[i].stanceSelected)return!1;return!0},this.removeUnitFromTeam=function(unit){for(var i in this.units)if(this.units[i].id==unit.id){this.units.splice(i,1);break}}}function Tile(row,column,dimensions){this.width=dimensions.width,this.height=dimensions.height,this.spacing=dimensions.spacing,this.row=row||0,this.column=column||0,this.oddRow=this.row%2?!0:!1,this.x=this.oddRow?this.column*(this.width+this.spacing):this.column*(this.width+this.spacing)+(this.width+this.spacing)/2,this.y=this.row*(this.height+this.spacing),this.adjacentTiles=[],this.unit="",this.index="",this.moveCost=0,this.rangeForWeapon=0,this.range=0,this.targetFor="",this.draw=function(){VirtArenaControl.Graphics.ctx.textAlign="left",VirtArenaControl.Graphics.ctx.font="10px Arial",this.unit&&this.unit.id===VirtArenaControl.Units.selectedUnit.id?VirtArenaControl.Graphics.ctx.fillStyle="rgba(200,255,255,0.35)":VirtArenaControl.Graphics.ctx.fillStyle="rgba(200,255,255,0.15)",VirtArenaControl.Graphics.ctx.strokeStyle="rgba(0,0,0,0.9)",VirtArenaControl.Graphics.ctx.fillRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.strokeRect(this.x,this.y,this.width,this.height)},this.drawIndex=function(){VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.fillStyle="white",VirtArenaControl.Graphics.ctx.fillText(this.row+","+this.column,this.x,this.y+this.height/3)},this.drawPath=function(){VirtArenaControl.Graphics.ctx.textAlign="left",VirtArenaControl.Graphics.ctx.font="16px Arial",VirtArenaControl.Graphics.ctx.fillStyle="green",VirtArenaControl.Graphics.ctx.fillText("P",this.x,this.y+this.height/3)},this.drawHover=function(){VirtArenaControl.Graphics.ctx.textAlign="left",VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.fillStyle="rgba(200,255,255,0.35)",VirtArenaControl.Graphics.ctx.fillRect(this.x,this.y,this.width,this.height),VirtArenaControl.Graphics.ctx.strokeStyle="white",VirtArenaControl.Graphics.strokeRectWithShadow(this.x,this.y,this.width,this.height,2,"#ffffff",2,0,1)},this.drawHighlight=function(color){VirtArenaControl.Graphics.ctx.fillStyle=color,VirtArenaControl.Graphics.ctx.fillRect(this.x,this.y,this.width,this.height)},this.drawHighlightForMovement=function(){this.drawHighlight("rgba(50,255,50,0.3)")},this.drawHighlightForAttack=function(){this.drawHighlight("rgba(255,50,50,0.4)")},this.drawHighlightForAttackConfirm=function(){this.drawHighlight("rgba(255,50,50,0.7)")},this.drawHighlightForAbility=function(){this.drawHighlight("rgba(50,50,255,0.5)")},this.drawBorderForActivatingUnit=function(){this.drawBorder("#00FF00")},this.drawBorder=function(color){VirtArenaControl.Graphics.ctx.lineHeight=3,VirtArenaControl.Graphics.ctx.strokeStyle=color,VirtArenaControl.Graphics.strokeRectWithShadow(this.x,this.y,this.width,this.height,3,"rgba(255,255,255,1)",2,0,1)},this.isOpen=function(){var tileIsOpen=!0;return this.unit&&(tileIsOpen=!1),tileIsOpen},this.setPositionOnBoardChange=function(){this.x=this.oddRow?this.column*(this.width+this.spacing):this.column*(this.width+this.spacing)+(this.width+this.spacing)/2,this.y=this.row*(this.height+this.spacing),this.x+=VirtArenaControl.Board.x+VirtArenaControl.Board.horizontalPadding,this.y+=VirtArenaControl.Board.y+VirtArenaControl.Board.topPadding},this.resetUnit=function(){this.unit=""}}function Tooltip(obj,hoverObject){this.x=0,this.y=0,this.xLeft=0,this.yTop=0,this.width=200,this.height=80,this.text="",this.type="",this.id="",this.title="",this.subtitle="",this.description="",this.obj="",this.hover=!1,this.hoverObject=hoverObject,this.columns=[],this.paddingLeft=10,this.paddingTop=15,this.titleHeight=38;for(var keys=Object.keys(obj),i=0;i<keys.length;i++)this[keys[i]]=obj[keys[i]];this.draw=function(){0!=this.xLeft&&0!=this.yTop&&(VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.fillStyle="#222222",VirtArenaControl.Graphics.ctx.fillRect(this.xLeft,this.yTop,this.width,this.height),VirtArenaControl.Graphics.ctx.font="15px Arial",VirtArenaControl.Graphics.ctx.strokeStyle="#555555",VirtArenaControl.Graphics.ctx.strokeRect(this.xLeft,this.yTop,this.width,this.titleHeight),VirtArenaControl.Graphics.ctx.fillStyle="#FFFFFF",VirtArenaControl.Graphics.ctx.fillText(this.title,this.x,this.yTop+.4*this.titleHeight),VirtArenaControl.Graphics.ctx.fillStyle="#FFFFFF",VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.fillText(this.subtitle.toUpperCase(),this.x,this.yTop+.8*this.titleHeight),VirtArenaControl.Graphics.ctx.font="10px Arial",VirtArenaControl.Graphics.ctx.fillStyle="#EEEEEE",this.drawDescription(),VirtArenaControl.Graphics.ctx.strokeStyle="#000000",VirtArenaControl.Graphics.ctx.strokeRect(this.xLeft,this.yTop,this.width,this.height))},this.update=function(){if(this.checkIfShouldHide(),"unit"==this.type){this.description=this.unitDescription(),this.columns=[{width:0},{width:0}],VirtArenaControl.Graphics.ctx.font="10px Arial";for(var i in this.description){var column=i%2;this.description[i].column=column;var string=this.description[i].key+": "+this.description[i].value,width=VirtArenaControl.Graphics.ctx.measureText(string).width;this.description[i].length=width,this.columns[column].width<width&&(this.columns[column].width=width)}this.width=this.paddingLeft*(this.columns.length+1);for(var i in this.columns)this.width+=this.columns[i].width;this.height=this.titleHeight+15*Math.ceil(this.description.length/2)+2*this.paddingTop,this.xLeft=this.x-this.width/2,this.yTop=this.y-this.height-10}else if("button"==this.type)if("stance"==this.subtype){this.description=this.stanceDescription(),this.columns=[{width:0},{width:0}],VirtArenaControl.Graphics.ctx.font="10px Arial";for(var i in this.description){var column=i%2;this.description[i].column=column;var string=this.description[i].key+": "+this.description[i].value,width=VirtArenaControl.Graphics.ctx.measureText(string).width;this.description[i].length=width,this.columns[column].width<width&&(this.columns[column].width=width)}this.width=this.paddingLeft*(this.columns.length+1);for(var i in this.columns)this.width+=this.columns[i].width;this.height=this.titleHeight+15*Math.ceil(this.description.length/2)+2*this.paddingTop,this.xLeft=this.x-this.width/2,this.yTop=this.y-this.height-10}else if("weapon"==this.subtype){this.description=this.weaponDescription(),this.columns=[{width:0},{width:0}],VirtArenaControl.Graphics.ctx.font="10px Arial";for(var i in this.description){var column=i%2;this.description[i].column=column;var string=this.description[i].key+": "+this.description[i].value,width=VirtArenaControl.Graphics.ctx.measureText(string).width;this.description[i].length=width,this.columns[column].width<width&&(this.columns[column].width=width)}this.width=this.paddingLeft*(this.columns.length+1);for(var i in this.columns)this.width+=this.columns[i].width;this.height=this.titleHeight+15*Math.ceil(this.description.length/2)+2*this.paddingTop,this.xLeft=this.x-this.width/2,this.yTop=this.y-this.height-10}},this.unitDescription=function(){var stats=[{key:"HP",value:this.obj.HP+"/"+this.obj.totalHP},{key:"Speed",value:this.obj.turnStats.speed},{key:"Stunned",value:this.obj.turnStats.isStunned},{key:"Move",value:this.obj.turnStats.move},{key:"Def",value:this.obj.turnStats.defense},{key:"Stability",value:this.obj.turnStats.stability},{key:"Evasion",value:this.obj.turnStats.evasion},{key:"Weapon",value:"Power "+this.obj.weapons.weapon1.power+" Range "+this.obj.weapons.weapon1.range}];return stats},this.stanceDescription=function(){var stats=[{key:"Speed",value:this.obj.speed},{key:"Move",value:this.obj.move},{key:"Def",value:this.obj.defense},{key:"Stability",value:this.obj.stability},{key:"Evasion",value:this.obj.evasion}];return stats},this.weaponDescription=function(){var stats=[{key:"Power",value:this.obj.power},{key:"Range",value:this.obj.range},{key:"Penetration",value:this.obj.penetration}];return stats},this.checkIfShouldHide=function(){var shouldHide=!0;this.hoverObject.hover&&(shouldHide=!1),shouldHide&&VirtArenaControl.Tooltips.removeTooltip(this)},this.drawDescription=function(){var numColumns=this.columns.length;VirtArenaControl.Graphics.ctx.textAlign="left";for(var i in this.description){var column=this.description[i].column,string=this.description[i].key+": "+this.description[i].value,x=0!=column?this.xLeft+this.columns[column-1].width+this.paddingLeft*(column+1):this.xLeft+this.paddingLeft,y=this.yTop+this.titleHeight+this.paddingTop+15*Math.floor(i/numColumns);VirtArenaControl.Graphics.ctx.fillText(string,x,y)}}}function Weapon(initVars){this.name="",this.number=0,this.power=0,this.range=0,this.penetration=0,this.impact=0,this.targetInRange=!1,this.special="",this.used=!1;var keys=Object.keys(initVars);for(var i in keys)this[keys[i]]=initVars[keys[i]];this.displayWeaponStats=function(){var returnString="";return console.log("\nWeapon Stats Logging"),console.log("Name: "+name),console.log("Power: "+power),console.log("Range: "+range),console.log("Penetration: "+penetration),console.log("Impact: "+impact),returnString+="Weapon: "+name+"<br>Power: "+power+"<br>Range: "+range,penetration>0&&(returnString+="<br>Penetration: "+penetration),impact>0&&(returnString+="<br>Impact: "+impact),"Lance"===name&&(returnString+="<br>+10 Penetration After Moving"),returnString},this.displayWeaponStatsTooltip=function(){var returnString="";return returnString+="Weapon: "+name+"<br />Power: "+power+"<br />Range: "+range,penetration>0&&(returnString+="<br />Penetration: "+penetration),impact>0&&(returnString+="<br />Impact: "+impact),"Lance"===name&&(returnString+="<br />+10 Penetration After Moving"),returnString},this.getPotentialPower=function(user,target){var power=this.power+user.turnStats.power;return power-=target.turnStats.defense}}function Card(initVars){this.name="",this.desc="",this.type="",this.cost=0,this.playable=[],this.effect="",this.companion="",this.ability="",this.reveal="none",this.misc="none",this.team="",this.positionInHand=0,this.cardsInHand=0,this.x=0,this.y=0,this.width=120,this.hoverWidth=200,this.defaultWidth=120,this.height=240,this.spacing=-20,this.drawText="",this.fontTitle="14px Arial",this.font="10px Arial",this.hover=!1,this.rotation=0,this.rotationPercent=0,this.baseRotationDifference=4,this.bottomSpacing=60,this.titleSpace=40,this.image=VirtArenaControl.Images.cardBackground;var keys=Object.keys(initVars);for(var i in keys)this[keys[i]]=initVars[keys[i]];this.draw=function(){if(this.update(),this.hover){var colors={fill:"#333333",stroke:"#000000",strokeTitle:"#555555",text:"#FFFFFF"};this.drawCard(colors,!1)}else if(this.disabled){var colors={fill:"#444444",stroke:"#000000",strokeTitle:"#555555",text:"#CCCCCC"};this.drawCard(colors,!0)}else{var colors={fill:"#666666",stroke:"#000000",strokeTitle:"#555555",text:"#FFFFFF"};this.drawCard(colors,!0)}},this.drawCard=function(colors,rotate){if(rotate){var xTranslate=this.x,yTranslate=this.y+Math.abs(this.height*this.rotationPercent),xDraw=0,yDraw=0;this.rotationPercent<0&&(xTranslate+=this.width,xDraw-=this.width),VirtArenaControl.Graphics.ctx.save(),VirtArenaControl.Graphics.ctx.translate(xTranslate,yTranslate),VirtArenaControl.Graphics.ctx.rotate(this.rotation),VirtArenaControl.Graphics.ctx.textAlign="center",this.image?VirtArenaControl.Graphics.ctx.drawImage(this.image,xDraw,yDraw,this.width,this.height):(VirtArenaControl.Graphics.ctx.fillStyle=colors.fill,VirtArenaControl.Graphics.ctx.fillRect(xDraw,yDraw,this.width,this.height)),VirtArenaControl.Graphics.ctx.strokeStyle=colors.strokeTitle,VirtArenaControl.Graphics.ctx.strokeRect(xDraw,yDraw,this.width,this.titleSpace),VirtArenaControl.Graphics.ctx.fillStyle=colors.text,VirtArenaControl.Graphics.ctx.font=this.fontTitle,VirtArenaControl.Graphics.ctx.fillText(this.name,xDraw+this.width/2,yDraw+15),VirtArenaControl.Graphics.ctx.font=this.font,VirtArenaControl.Graphics.ctx.fillText(this.type.toUpperCase(),xDraw+this.width/2,yDraw+30),this.image||(VirtArenaControl.Graphics.ctx.strokeStyle=colors.stroke,VirtArenaControl.Graphics.ctx.strokeRect(xDraw,yDraw,this.width,this.height)),VirtArenaControl.Graphics.ctx.restore()}else{var xDraw=this.x,yDraw=this.y;VirtArenaControl.Graphics.ctx.textAlign="center",this.image?VirtArenaControl.Graphics.ctx.drawImage(this.image,xDraw,yDraw,this.width,this.height):(VirtArenaControl.Graphics.ctx.fillStyle=colors.fill,VirtArenaControl.Graphics.ctx.fillRect(xDraw,yDraw,this.width,this.height)),VirtArenaControl.Graphics.ctx.strokeStyle=colors.strokeTitle,VirtArenaControl.Graphics.ctx.strokeRect(xDraw,yDraw,this.width,this.titleSpace),VirtArenaControl.Graphics.ctx.fillStyle=colors.text,VirtArenaControl.Graphics.ctx.font=this.fontTitle,VirtArenaControl.Graphics.ctx.fillText(this.name,xDraw+this.width/2,yDraw+15),VirtArenaControl.Graphics.ctx.font=this.font,VirtArenaControl.Graphics.ctx.fillText(this.type.toUpperCase(),xDraw+this.width/2,yDraw+30),this.image||(VirtArenaControl.Graphics.ctx.strokeStyle=colors.stroke,VirtArenaControl.Graphics.ctx.strokeRect(xDraw,yDraw,this.width,this.height)),this.hover}},this.update=function(updateObj){updateObj&&(this.positionInHand=updateObj.index,this.cardsInHand=updateObj.cardsInHand,this.oddLength=updateObj.oddLength);var startX,dynamicX;this.spacing=40-10*this.cardsInHand,this.width=this.hover?this.hoverWidth:this.defaultWidth,startX=this.oddLength?-(this.cardsInHand/2*this.defaultWidth+this.spacing):-(this.cardsInHand/2*this.defaultWidth+1.5*this.spacing),dynamicX=startX+this.positionInHand*(this.defaultWidth+this.spacing),this.x=this.hover?Math.round(VirtArenaControl.Camera.width/2+dynamicX-this.width/4):Math.round(VirtArenaControl.Camera.width/2+dynamicX),this.y=this.hover?Math.round(VirtArenaControl.Camera.height-this.height):Math.round(VirtArenaControl.Camera.height-this.bottomSpacing);var rotationDegrees=this.baseRotationDifference*(this.positionInHand-(this.cardsInHand-1)/2),rotationSign=0>rotationDegrees?-1:1;this.rotationPercent=0!=rotationDegrees?rotationSign*(Math.abs(rotationDegrees)/180):0,this.rotation=Math.PI*this.rotationPercent,
VirtArenaControl.Graphics.ctx.font=this.font,VirtArenaControl.Graphics.ctx.measureText(this.name).width>.9*this.width&&(this.fontTitle="13px Arial"),this.disabled=this.checkDisabled()},this.checkDisabled=function(){var disabled=!0;return this.companion?VirtArenaControl.Units.currentUnitActivating.team===this.team&&VirtArenaControl.Units.currentUnitActivating.commander===!0&&"activateUnit"==VirtArenaControl.TurnController.currentSubphase&&(disabled=!1):this.ability&&"attack"==this.ability.type&&VirtArenaControl.Units.currentUnitActivating.team===this.team&&"activateUnit"==VirtArenaControl.TurnController.currentSubphase?disabled=!1:this.ability&&"defense"==this.ability.type&&VirtArenaControl.Units.currentUnitActivating.team===this.team&&"activateUnit"==VirtArenaControl.TurnController.currentSubphase&&(disabled=!1),disabled},this.onClick=function(){if(this.companion)this.team.commander.id===VirtArenaControl.Units.currentUnitActivating.id&&VirtArenaControl.TurnController.setCurrentAbility("spawnCompanion",{card:this,team:this.team,companion:this.companion});else if(this.ability)switch(this.ability.type){case"attack":switch(this.ability.target){case"self":VirtArenaControl.TurnController.setCurrentAbility("attack",{card:this,currentUnit:VirtArenaControl.Units.currentUnitActivating,ability:this.ability,team:this.team})}break;case"defense":switch(this.ability.target){case"ally":VirtArenaControl.TurnController.setCurrentAbility("defense",{card:this,ability:this.ability,team:this.team})}}}}function Deck(initVars){if(this.cardsInHand=[],this.cardsInDeck=[],this.discardPile=[],this.team={},initVars){var keys=Object.keys(initVars);for(var i in keys)this[keys[i]]=initVars[keys[i]];this.createDeck(initVars.commander)}}function Arturius(){this.setStartingVars(),this.name="Arturius",this.unitType="Arturius",this.unitClass="Commander",this.unitArt=VirtArenaControl.Images.arturiusUnitArt,this.HP=200,this.totalHP=200,this.energy=90,this.energyExtra=30,this.capacityLimit=120,this.supply=480,this.powerNextAttackThisTurn=!1,this.penetrationNextTurn=!1;var weapon1={name:"Melee",number:1,power:30,range:1,penetration:80},weapon2={name:"Ranged",number:2,power:50,range:5,penetration:40,special:"Power -20 at Range 1"};this.weapons.weapon1=new Weapon(weapon1),this.weapons.weapon2=new Weapon(weapon2);var stance1={name:"Fast",desc:"May Move 2 once at any point during its activation if within Range 1 of an enemy.",number:1,speed:60,move:2,defense:40,stability:0,evasion:50,misc:"Move 2 if Range 1 of enemy"},stance2={name:"Neutral",desc:"Versatile. Dual Wield (may use both Weapons).",number:2,speed:40,move:2,defense:40,stability:0,evasion:40,versatile:!0,dualWield:!0},stance3={name:"Reactive",desc:"Deflect +40. Reveal: Move 1",number:3,speed:1,move:1,defense:10,stability:40,evasion:60,deflect:40,reveal:"Move 1"};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2),this.stances.stance3=new Stance(stance3),this.unitTypeSpecialValues=function(){this.powerNextAttackThisTurn&&(this.power+=20,this.powerNextAttackThisTurn=!1,console.log("Pre-emptive Strike Stance 2: +20 Power next attack")),this.penetrationNextTurn&&turnNumber>arturiusTempTurnNumber&&(this.penetration+=20,this.penetrationNextTurn=!1,console.log("Pre-emptive Strike Stance 3: +20 Penetration next attack")),console.log("Unit Type "+this.unitType+" special values from stances/weapon/etc added to stat values.")}}function Imperator(){this.setStartingVars(),this.name="Imperator",this.unitType="Imperator",this.unitClass="Commander",this.unitArt=VirtArenaControl.Images.imperatorUnitArt,this.HP=300,this.totalHP=300,this.previousHP=300,this.energy=90,this.energyExtra=30,this.capacityLimit=100,this.supply=400,this.speed=0,this.range=0,this.irradiateDamageTarget=!1;var weapon1={name:"Melee",number:1,power:60,range:1,penetration:60,special:"Power -20 if target moved"},weapon2={name:"Ranged",number:2,power:40,range:3,penetration:20,impact:20};this.weapons.weapon1=new Weapon(weapon1),this.weapons.weapon2=new Weapon(weapon2);var stance1={name:"Fast",desc:"May Push 1 or Pull 1 target enemy within Range 1 after moving.",number:1,speed:50,move:2,defense:50,stability:60,evasion:10,misc:"Push 1 or Pull 1 if Range 1 of enemy after moved"},stance2={name:"Neutral",desc:"Vampiric",number:2,speed:20,move:1,defense:50,stability:80,evasion:10,vampiric:!0},stance3={name:"Tank",desc:"Immune to Stun",number:3,speed:10,move:2,defense:100,stability:999,evasion:5,special:"Immune to Stun"};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2),this.stances.stance3=new Stance(stance3)}function Lancer(){this.setStartingVars(),this.name="Melee Agile",this.unitType="Lancer",this.unitClass="Companion",this.unitArt=VirtArenaControl.Images.lancerUnitArt,this.HP=80,this.totalHP=80,this.energy=60,this.energyExtra=20;var weapon1={name:"Melee",number:1,power:40,range:1,penetration:60};this.weapons.weapon1=new Weapon(weapon1);var stance1={name:"Blur",desc:"+20 Penetration",number:1,speed:65,move:1,defense:10,stability:20,evasion:60,misc:"Penetration +20"},stance2={name:"Reactive",desc:"+10 Power, must move in a straight line",number:3,speed:20,move:3,defense:20,stability:30,evasion:30,misc:"Power +10"};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2)}function Knight(){this.setStartingVars(),this.name="Melee Strong",this.unitType="Knight",this.unitClass="Companion",this.unitArt=VirtArenaControl.Images.knightUnitArt,this.HP=120,this.totalHP=120,this.energy=60,this.energyExtra=20;var weapon1={name:"Melee",number:1,power:50,range:1,penetration:50};this.weapons.weapon1=new Weapon(weapon1);var stance1={name:"Rush",desc:"-20 Penetration",number:1,speed:63,move:2,defense:50,stability:40,evasion:20,misc:"Penetration -20"},stance2={name:"Defense",desc:"Cannot be Pushed or Pulled",number:3,speed:23,move:1,defense:60,stability:60,evasion:0,misc:"Immune to Push and Pull"};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2)}function Praetorian(){this.setStartingVars(),this.name="Defensive Ranged",this.unitType="Praetorian",this.unitClass="Companion",this.unitArt=VirtArenaControl.Images.praetorianUnitArt,this.HP=100,this.totalHP=100,this.energy=60,this.energyExtra=20;var weapon1={name:"Ranged",number:1,power:30,range:4,penetration:20,special:"Impact +10 at Range 1"};this.weapons.weapon1=new Weapon(weapon1);var stance1={name:"Steady",desc:"+1 Rapidfire",number:1,speed:50,move:1,defense:30,stability:30,evasion:10,misc:"Rapidfire +1"},stance2={name:"Guard",desc:"+10 Defense if within Range 1 of an ally",number:3,speed:20,move:1,defense:60,stability:40,evasion:0,misc:"Defense +10 if Range 1 of ally"};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2)}function Hecate(){this.setStartingVars(),this.name="Long Range",this.unitType="Hecate",this.unitClass="Companion",this.unitArt=VirtArenaControl.Images.hecateUnitArt,this.HP=80,this.totalHP=80,this.energy=60,this.energyExtra=20;var weapon1={name:"Ranged",number:1,power:30,range:6,penetration:30};this.weapons.weapon1=new Weapon(weapon1);var stance1={name:"Reposition",desc:"-2 Range",number:1,speed:77,move:2,defense:20,stability:30,evasion:60,misc:"Range -2"},stance2={name:"Snipe",desc:"Precision",number:3,speed:27,move:1,defense:50,stability:40,evasion:0,precision:!0};this.stances.stance1=new Stance(stance1),this.stances.stance2=new Stance(stance2)}!function(){VirtArenaControl={init:function(){this.Graphics.init(),this.Updater.init(),this.Board.init(),this.Listeners.jquery.init(),this.Buttons.init()}},VirtArenaControl.Classes={},VirtArenaControl.Mouse={},VirtArenaControl.Listeners={},VirtArenaControl.Camera={width:640,height:600,x:0,y:0},VirtArenaControl.Interaction={},VirtArenaControl.TurnController={},VirtArenaControl.ObjectController={},VirtArenaControl.Units={},VirtArenaControl.AI={},VirtArenaControl.AI.Scripts={},VirtArenaControl.Abilities={},VirtArenaControl.Buttons={},VirtArenaControl.Avatars={},VirtArenaControl.Tooltips={},VirtArenaControl.Graphics={canvas:void 0,ctx:void 0,drawFunctions:[],init:function(){this.canvas=document.getElementById("canvas1"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,VirtArenaControl.Camera.width=this.canvas.width,VirtArenaControl.Camera.height=this.canvas.height,VirtArenaControl.Camera.x=0,VirtArenaControl.Camera.y=0,this.drawFunctions.push("redrawCanvas"),this.drawFunctions.push("drawBoardBackground"),this.drawFunctions.push("drawBoardTiles"),this.drawFunctions.push("drawUnits"),this.drawFunctions.push("drawButtons"),this.drawFunctions.push("drawActivationOrder"),this.drawFunctions.push("drawPlayerCards"),this.drawFunctions.push("drawTooltips"),this.drawFunctions.push("drawCurrentPhase")},setShadow:function(color,blur,offsetX,offsetY){this.ctx.shadowColor=color,this.ctx.shadowBlur=blur,this.ctx.shadowOffsetX=offsetX,this.ctx.shadowOffsetY=offsetY},fillRectWithShadow:function(x,y,width,height,color,blur,offsetX,offsetY){this.ctx.save(),this.setShadow(color,blur,offsetX,offsetY),this.ctx.fillRect(x,y,width,height),this.ctx.restore()},fillTextWithShadow:function(text,x,y,color,blur,offsetX,offsetY){this.ctx.save(),this.setShadow(color,blur,offsetX,offsetY),this.ctx.fillText(text,x,y),this.ctx.restore()},strokeRectWithShadow:function(x,y,width,height,lineWidth,color,blur,offsetX,offsetY){this.ctx.save(),this.ctx.lineWidth=lineWidth,this.setShadow(color,blur,offsetX,offsetY),this.ctx.strokeRect(x,y,width,height),this.ctx.restore()}},VirtArenaControl.Updater={updateFunctions:[],framerate:1e3/30,phaseChangeDelayCounter:0,init:function(){this.updateFunctions.push("checkCanvasSize"),this.updateFunctions.push("getMousePosition"),this.updateFunctions.push("getHoveredObjects"),this.updateFunctions.push("checkUnitPositions"),this.updateFunctions.push("updateButtonPositions"),this.updateFunctions.push("updateBoardPosition"),this.updateFunctions.push("updateDeck"),this.updateFunctions.push("updateTileVariables"),this.updateFunctions.push("updateActivationAvatars"),this.updateFunctions.push("updateUnitAnimations"),this.updateFunctions.push("updateTooltips")}},Scripts={},VirtArenaControl.Images={}}(),function(){function multilineCheckNextWord(lineIn,currentIndex,maxSizeLeft){for(var curStringIndex=currentIndex+1,tempWord=" ";lineIn[curStringIndex]&&" "!=lineIn[curStringIndex];)tempWord+=lineIn[curStringIndex],curStringIndex++;return VirtArenaControl.Graphics.ctx.measureText(tempWord).width<maxSizeLeft?[tempWord,curStringIndex]:null}Scripts.mouseInObject=function(object){var mouse=VirtArenaControl.Mouse;return mouse.x>=object.x&&mouse.x<=object.x+object.width&&mouse.y>=object.y&&mouse.y<=object.y+object.height?!0:!1},Scripts.sortUnitsBySpeed=function(a,b){return a.turnStats.speed>b.turnStats.speed?-1:a.turnStats.speed<b.turnStats.speed?1:a.turnStats.speed===b.turnStats.speed&&a.team.hasPriority?-1:a.turnStats.speed!==b.turnStats.speed||a.team.hasPriority?void 0:1},Scripts.sortDescending=function(a,b){return a>b?-1:b>a?1:Math.floor(2*Math.random()-1)},Scripts.sortAscending=function(a,b){return b>a?-1:a>b?1:Math.floor(2*Math.random()-1)},Scripts.sortStancesDescending=function(a,b){return a.value>b.value?-1:a.value<b.value?1:Math.floor(2*Math.random())},Scripts.rollDamageDie=function(){var roll=Math.floor(3*Math.random()),crit=Math.floor(2*Math.random())&&roll>0?!0:!1,dieRoll={roll:roll,crit:crit};return dieRoll},Scripts.getMoveRangeBetweenTiles=function(startTile,endTile){var tiles=VirtArenaControl.Board.tiles,openTiles=[],closedTiles=[],blockedTiles=[],tempRange=1;for(var i in startTile.adjacentTiles){var index=startTile.adjacentTiles[i];tiles[index].isOpen()?(tiles[index].tempParentTile=startTile,tiles[index].tempRange=tempRange,openTiles.push(tiles[index])):(tiles[index].tempParentTile=startTile,tiles[index].tempRange=tempRange,blockedTiles.push(tiles[index]))}for(var error=0;1e3>error&&openTiles.length>0;){error++;for(var i=0;i<openTiles.length;i++){var nextTempRange=openTiles[i].tempRange+1;for(var j in openTiles[i].adjacentTiles){var index=openTiles[i].adjacentTiles[j],indexInOpenTiles=openTiles.indexOf(tiles[index]);-1===indexInOpenTiles&&tiles[index].isOpen()?(tiles[index].tempParentTile=openTiles[i],tiles[index].tempRange=nextTempRange,openTiles.push(tiles[index])):-1!=indexInOpenTiles&&openTiles[indexInOpenTiles].tempRange>nextTempRange?(openTiles[indexInOpenTiles].tempParentTile=openTiles[i],openTiles[indexInOpenTiles].tempRange=nextTempRange):tiles[index].isOpen()||(-1===blockedTiles.indexOf(tiles[index])?(tiles[index].tempParentTile=openTiles[i],tiles[index].tempRange=nextTempRange,blockedTiles.push(tiles[index])):tiles[index].tempRange>nextTempRange&&(tiles[index].tempParentTile=openTiles[i],tiles[index].tempRange=nextTempRange))}closedTiles.push(openTiles[i])}for(var i=0;i<closedTiles.length;i++){var index=openTiles.indexOf(closedTiles[i]);-1!=index&&openTiles.splice(index,1)}}var rangeToEndTile=endTile.tempRange;return rangeToEndTile},Scripts.multilineStringReturn=function(lineIn,maxSize,font){var totalWidth,numLines,linesToReturn,curStringIndex,currentWidth,nextWord;VirtArenaControl.Graphics.ctx.font=font,curStringIndex=0,linesToReturn=[],totalWidth=VirtArenaControl.Graphics.ctx.measureText(lineIn).width,totalWidth>maxSize?numLines=Math.ceil(totalWidth/maxSize):linesToReturn[0]=lineIn;for(var i=0;numLines>i;i++)for(linesToReturn[i]="",currentWidth=0;maxSize>currentWidth&&lineIn[curStringIndex];){if(50>maxSize-currentWidth&&" "==lineIn[curStringIndex]){if(nextWord=multilineCheckNextWord(lineIn,curStringIndex,maxSize-currentWidth),null==nextWord){curStringIndex++;break}linesToReturn[i]+=nextWord[0],curStringIndex=nextWord[1]}else linesToReturn[i]+=lineIn[curStringIndex],curStringIndex++;currentWidth=VirtArenaControl.Graphics.ctx.measureText(linesToReturn[i]).width}return linesToReturn}}(),function(){VirtArenaControl.Units={units:[],teams:[],selectedUnit:"",movementStepDelay:350,deathDelay:1e3,activationOrder:[],currentUnitActivating:"",path:[],chooseVirtCommanderVirts:["Arturius","Imperator"],getUnitsToDraw:function(){var unitsToDraw=[];for(var i in this.units)this.units[i]&&unitsToDraw.push(this.units[i]);return unitsToDraw}}}(),function(){VirtArenaControl.ObjectController={movementStepDelay:350,path:[],unitMoving:!1,setUnitTile:function(unit,tile){var oldTile=unit.tile;unit.tile=tile,tile.unit=unit,oldTile&&(oldTile.unit="")},selectUnit:function(unit){for(var i in VirtArenaControl.Units.units)if(VirtArenaControl.Units.units[i]===unit)return void(VirtArenaControl.Units.selectedUnit=VirtArenaControl.Units.units[i])},resetSelectedObject:function(){VirtArenaControl.Units.selectedUnit&&(VirtArenaControl.Units.selectedUnit="")},setActivationOrder:function(){VirtArenaControl.Units.activationOrder=[];var units=VirtArenaControl.Units.units;for(var i in units)units[i].canActivateThisTurn()&&VirtArenaControl.Units.activationOrder.push(units[i]);VirtArenaControl.Units.activationOrder.sort(Scripts.sortUnitsBySpeed);for(var i in VirtArenaControl.Units.activationOrder)VirtArenaControl.Units.activationOrder[i].activationOrderIndex=i},setUnitActivating:function(unit){VirtArenaControl.Units.currentUnitActivating=unit},resetUnitValues:function(){this.setLastStanceSelected(),this.resetWeapons(),this.resetHasActivated(),this.resetHasAttacked(),this.resetStun(),this.resetAIVariables()},setLastStanceSelected:function(){var units=VirtArenaControl.Units.units;for(var i in units)units[i].lastStanceSelected=units[i].stanceSelected,units[i].stanceSelected=""},resetWeapons:function(){var units=VirtArenaControl.Units.units;for(var i in units){units[i].weaponSelected={};var weapons=Object.keys(units[i].weapons);for(var j in weapons){var weapon=weapons[j];units[i].weapons[weapon].used=!1}}},resetHasActivated:function(){var units=VirtArenaControl.Units.units;for(var i in units)units[i].activated=!1},resetHasAttacked:function(){var units=VirtArenaControl.Units.units;for(var i in units)units[i].hasAttacked&&(units[i].hasAttacked=!1)},resetStun:function(){var units=VirtArenaControl.Units.units;for(var i in units)units[i].turnStats.isStunned&&!units[i].turnStats.stunThisTurn&&(units[i].turnStats.isStunned=!1),units[i].turnStats.stunThisTurn&&(units[i].stunThisTurn=!1)},resetAIVariables:function(){var units=VirtArenaControl.Units.units;for(var i in units)units[i].team.aiTeam&&(units[i].ai.hasMoved=!1,units[i].ai.hasUsedCards=!1,units[i].ai.hasAttacked=!1,units[i].ai.targetUnit=null,units[i].ai.targetTile=null)},resetActivationOrder:function(){VirtArenaControl.Units.activationOrder=[],VirtArenaControl.Units.currentUnitActivating=""},setUnitStance:function(unit,stanceNumber){unit.setStance("stance"+stanceNumber)},selectCommanderUnit:function(unit,team){team.addCommander(unit),VirtArenaControl.Buttons.removeButton("selectCommander"),VirtArenaControl.TurnController.gameStarter.nextPhase()},unitHasDied:function(unit){unit.commander?VirtArenaControl.TurnController.endOfGame():(this.removeUnitFromActivationOrder(unit),setTimeout(function(){unit.dontDraw=!0,unit.team.removeUnitFromTeam(unit)},VirtArenaControl.Units.deathDelay))},removeUnitFromActivationOrder:function(unit){var index=VirtArenaControl.Units.activationOrder.indexOf(unit);VirtArenaControl.Units.activationOrder.splice(index,1)},unactivatedUnitsInActivationOrder:function(){for(var i in VirtArenaControl.Units.activationOrder)if(!VirtArenaControl.Units.activationOrder[i].activated)return!0;return!1},setEndOfActivationVariables:function(unit){unit.activated=!0,unit.removeActivationAbilities()},setTileRange:function(unit){var initialTile=unit.tile,tiles=VirtArenaControl.Board.tiles,openTiles=[],closedTiles=[],range=1;for(var i in initialTile.adjacentTiles){var index=initialTile.adjacentTiles[i];tiles[index].parentTile=initialTile,tiles[index].range=range,openTiles.push(tiles[index])}for(var error=0;1e3>error&&openTiles.length>0;){error++;for(var i=0;i<openTiles.length;i++){var nextRange=openTiles[i].range+1;for(var j in openTiles[i].adjacentTiles){var index=openTiles[i].adjacentTiles[j],indexInOpenTiles=openTiles.indexOf(tiles[index]);-1===indexInOpenTiles?(tiles[index].parentTile=openTiles[i],tiles[index].range=nextRange,openTiles.push(tiles[index])):openTiles[indexInOpenTiles].range>nextRange&&(openTiles[indexInOpenTiles].parentTile=openTiles[i],openTiles[indexInOpenTiles].range=nextRange)}closedTiles.push(openTiles[i])}for(var i=0;i<closedTiles.length;i++){var index=openTiles.indexOf(closedTiles[i]);-1!=index&&openTiles.splice(index,1)}}},addUnit:function(unit){VirtArenaControl.Units.units.push(unit),unit.avatar=VirtArenaControl.Avatars.newAvatar(unit)},getUnitObject:function(unitName){var unit=jQuery.extend(!0,{},new window[unitName]);return unit.id=this.setUnitId(unit),unit.setStartingStance(),unit},setUnitId:function(unit){var id=VirtArenaControl.Units.units.length;for(var i in VirtArenaControl.Units.units)VirtArenaControl.Units.units[i].id==id&&id++;return id}}}(),function(){VirtArenaControl.TurnController={turnOrder:["startOfTurn","stanceSelection","unitActivation","endOfTurn","END"],startOfTurn:{subphaseOrder:["replenishSpecialActionBar","drawCards","startOfTurnBoosts"],replenishSpecialActionBar:{},drawCards:{},startOfTurnBoosts:{}},stanceSelection:{subphaseOrder:["selectStances","setActivationOrder"],selectStances:{},setActivationOrder:{}},unitActivation:{subphaseOrder:["nextUnitActivation","activateUnit","endActivation"],nextUnitActivation:{},startOfActivationBoosts:{},movementSubphase:{},attackSubphase:{},activateUnit:{},endActivation:{}},endOfTurn:{subphaseOrder:["cycleCards","setVariablesForEndOfTurn"],cycleCards:{},setVariablesForEndOfTurn:{}},gameEnd:!1,currentPhase:"",currentSubphase:"",currentAction:{action:"",user:"",target:"",range:0,misc:{},card:""},currentAbility:{action:"",user:"",target:"",range:0,misc:{},card:""},phaseChangeDelay:500,delayingPhaseChange:!1,startTurn:function(){this.nextPhase()},nextPhase:function(){var phaseIndex,goToNextSubphase,objControl=VirtArenaControl.ObjectController,continueActivation="unitActivation"===this.currentPhase&&objControl.unactivatedUnitsInActivationOrder()?!0:!1,goToNextPhase="END"!==this.currentSubphase&&""!==this.currentSubphase||continueActivation?!1:!0;goToNextPhase&&(phaseIndex=this.turnOrder.indexOf(this.currentPhase),this.currentPhase=this.turnOrder[phaseIndex+1],console.log("PHASE:"+this.currentPhase),"END"!==this.currentPhase||this.gameEnd||(this.currentPhase=this.turnOrder[0])),goToNextSubphase="END"==this.currentPhase||this.gameEnd?!1:!0,goToNextSubphase&&this.nextSubphase()},nextSubphase:function(){var subphase,subphaseIndex,phase=this[this.currentPhase];-1===phase.subphaseOrder.indexOf(this.currentSubphase)?(subphase=phase.subphaseOrder[0],this.currentSubphase=subphase):(subphaseIndex=phase.subphaseOrder.indexOf(this.currentSubphase),subphase=phase.subphaseOrder[subphaseIndex+1]||"END",this.currentSubphase=subphase),"END"!=this.currentSubphase?phase[this.currentSubphase]():this.nextPhase()},delayPhaseChange:function(delay){var delay=delay||VirtArenaControl.TurnController.phaseChangeDelay;VirtArenaControl.TurnController.delayingPhaseChange=!0,setTimeout(function(){VirtArenaControl.TurnController.nextPhase(),VirtArenaControl.TurnController.delayingPhaseChange=!1},delay)},selectCommanderPhase:function(team){console.log("PHASE: selectCommanderPhase: "+team.name),VirtArenaControl.Buttons.addButton("selectCommander",{team:team})},endOfGame:function(){var teams=VirtArenaControl.Units.teams,losingTeam="",winningTeam="";for(var i in teams)teams[i].commander.alive?winningTeam=teams[i].name:losingTeam=teams[i].name;this.gameEnd=!0,console.log(winningTeam+" wins!")},setCurrentAction:function(action,misc){switch(action){case"attack":this.currentAction={action:action,user:misc.attackingUnit,target:misc.targetUnit,range:misc.range}}},resetCurrentAction:function(){this.currentAction={action:"",user:"",target:"",range:0,misc:{},card:""}},setCurrentAbility:function(ability,misc){switch(ability){case"attack":this.currentAbility={ability:ability,user:misc.currentUnit,target:misc.currentUnit,misc:{team:misc.team,ability:misc.ability},card:misc.card};break;case"defense":this.currentAbility={ability:ability,user:misc.currentUnit,target:"ally",misc:{team:misc.team,ability:misc.ability},card:misc.card};break;case"spawnCompanion":this.currentAbility={ability:ability,user:misc.team.commander,target:"tile",range:1,misc:{team:misc.team,companion:misc.companion},card:misc.card},VirtArenaControl.ObjectController.setTileRange(this.currentAbility.user)}},resetCurrentAbility:function(){this.currentAbility={action:"",user:"",target:"",range:0,misc:{},card:""}},endPhaseEarly:function(){if(!this.delayingPhaseChange)switch(this.currentPhase){case"stanceSelection":switch(this.currentSubphase){case"selectStances":VirtArenaControl.Buttons.removeButton("selectStance"),VirtArenaControl.TurnController.delayPhaseChange()}break;case"unitActivation":switch(this.currentSubphase){case"movementSubphase":VirtArenaControl.ObjectController.endMovement();break;case"attackSubphase":VirtArenaControl.ObjectController.endAttackSubphase();break;default:this.delayPhaseChange()}break;default:this.delayPhaseChange()}},getCurrentPhaseText:function(){switch(this.currentSubphase){case"drawCards":return"Draw Cards";case"selectStances":return"Select Stances";case"activateUnit":return"Unit Activation"}return""}},VirtArenaControl.TurnController.gameStarter={gameStarted:!1,startSequence:["selectPlayerCommander","selectEnemyCommander"],currentPhase:"",startupPhaseChangeDelay:100,startGame:function(){console.log("Starting game"),VirtArenaControl.TurnController.gameStarter.gameStarted||(VirtArenaControl.TurnController.gameStarter.gameStarted=!0,VirtArenaControl.TurnController.gameStarter.setupTeams(),VirtArenaControl.Buttons.removeButton("startGame")),VirtArenaControl.TurnController.gameStarter.nextPhase()},setupTeams:function(){VirtArenaControl.Units.teams.blueTeam=new Team("blueTeam","blue","player"),VirtArenaControl.Units.teams.redTeam=new Team("redTeam","red","ai")},selectPlayerCommander:function(){console.log("Select Player Unit");var team=VirtArenaControl.Units.teams.blueTeam;VirtArenaControl.TurnController.selectCommanderPhase(team)},selectEnemyCommander:function(){console.log("Select Enemy Unit");var unitName=(VirtArenaControl.Units.teams.redTeam,"Imperator");VirtArenaControl.Units.teams.blueTeam.commander.unitType===unitName&&(unitName="Arturius"),VirtArenaControl.Units.teams.redTeam.addCommander(unitName),VirtArenaControl.TurnController.gameStarter.nextPhase()},selectCommanderPhaseEnd:function(){var team,tiles;switch(this.currentPhase){case"selectPlayerCommander":team=VirtArenaControl.Units.teams.blueTeam,tiles={commanderTile:51,secondTile:38,thirdTile:63};break;case"selectEnemyCommander":team=VirtArenaControl.Units.teams.redTeam,tiles={commanderTile:60,secondTile:48,thirdTile:73}}team&&tiles&&this.setStartingPosition(team,tiles)},setStartingPosition:function(team,tiles){team.setStartingPosition(tiles)},nextPhase:function(){var obj=VirtArenaControl.TurnController.gameStarter;switch(obj.currentPhase){case"":obj.currentPhase=obj.startSequence[0];break;case obj.startSequence[0]:obj.selectCommanderPhaseEnd(),obj.currentPhase=obj.startSequence[1];break;case obj.startSequence[1]:obj.selectCommanderPhaseEnd(),obj.currentPhase=obj.startSequence[2];break;default:console.log("ERROR: Start sequence phase cannot be matched. Please check VirtArenaControl.TurnController.gameStarter.nextPhase.")}obj.currentPhase||(obj.currentPhase="END"),setTimeout(function(){"END"!=obj.currentPhase?obj[obj.currentPhase]():VirtArenaControl.TurnController.startTurn()},VirtArenaControl.TurnController.gameStarter.startupPhaseChangeDelay)}},VirtArenaControl.TurnController.startOfTurn.replenishSpecialActionBar=function(){console.log("	subPHASE: replenishSpecialActionBar"),VirtArenaControl.TurnController.delayPhaseChange(500)},VirtArenaControl.TurnController.startOfTurn.drawCards=function(){console.log("	subPHASE: drawCards");var teams=Object.keys(VirtArenaControl.Units.teams);for(var i in teams)VirtArenaControl.Units.teams[teams[i]].deck.drawCardsPhase();VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.startOfTurn.startOfTurnBoosts=function(){console.log("	subPHASE: startOfTurnBoosts"),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.stanceSelection.selectStances=function(){console.log("	subPHASE: selectStances");var team=VirtArenaControl.Units.teams.blueTeam;VirtArenaControl.Buttons.addButton("selectStances",{team:team}),VirtArenaControl.AI.Scripts.stanceSelection(VirtArenaControl.Units.teams.redTeam)},VirtArenaControl.TurnController.stanceSelection.setActivationOrder=function(){console.log("	subPHASE: setActivationOrder"),VirtArenaControl.ObjectController.setActivationOrder(),console.log("Activation Order:",VirtArenaControl.Units.activationOrder),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.unitActivation.nextUnitActivation=function(){console.log("	subPHASE: nextUnitActivation");var indexOfCurrentUnit=VirtArenaControl.Units.activationOrder.indexOf(VirtArenaControl.Units.currentUnitActivating),nextUnitToActivate=VirtArenaControl.Units.activationOrder[indexOfCurrentUnit+1];VirtArenaControl.ObjectController.setUnitActivating(nextUnitToActivate),VirtArenaControl.ObjectController.selectUnit(nextUnitToActivate),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.unitActivation.startOfActivationBoosts=function(){console.log("	subPHASE: startOfActivationBoosts - "+VirtArenaControl.Units.currentUnitActivating.name),VirtArenaControl.Units.currentUnitActivating.team.aiTeam&&VirtArenaControl.AI.Scripts.aiActivationControl(VirtArenaControl.Units.currentUnitActivating)},VirtArenaControl.TurnController.unitActivation.activateUnit=function(){console.log("	subPHASE: activateUnit - "+VirtArenaControl.Units.currentUnitActivating.name),VirtArenaControl.ObjectController.setTileMoveCosts(VirtArenaControl.Units.currentUnitActivating),VirtArenaControl.ObjectController.setTileRangeForWeapons(VirtArenaControl.Units.currentUnitActivating),VirtArenaControl.Units.currentUnitActivating.team.aiTeam&&VirtArenaControl.AI.Scripts.aiActivationControl(VirtArenaControl.Units.currentUnitActivating)},VirtArenaControl.TurnController.unitActivation.endActivation=function(){console.log("	subPHASE: endActivation - "+VirtArenaControl.Units.currentUnitActivating.name),VirtArenaControl.ObjectController.setEndOfActivationVariables(VirtArenaControl.Units.currentUnitActivating),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.endOfTurn.cycleCards=function(){console.log("	subPHASE: cycleCards"),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.TurnController.endOfTurn.setVariablesForEndOfTurn=function(){console.log("	subPHASE: setVariablesForEndOfTurn"),VirtArenaControl.ObjectController.resetUnitValues(),VirtArenaControl.ObjectController.resetActivationOrder(),VirtArenaControl.TurnController.delayPhaseChange()}}(),Deck.prototype.createDeck=function(commander){var deck={cards:[]};deck.cards.push(new Card({name:"Melee Agile",type:"companion",companion:"Lancer",team:this.team})),deck.cards.push(new Card({name:"Melee Agile",type:"companion",companion:"Lancer",team:this.team})),deck.cards.push(new Card({name:"Melee Strong",type:"companion",companion:"Knight",team:this.team})),deck.cards.push(new Card({name:"Melee Strong",type:"companion",companion:"Knight",team:this.team})),deck.cards.push(new Card({name:"Defensive Ranged",type:"companion",companion:"Praetorian",team:this.team})),deck.cards.push(new Card({name:"Defensive Ranged",type:"companion",companion:"Praetorian",team:this.team})),deck.cards.push(new Card({name:"Long Ranged",type:"companion",companion:"Hecate",team:this.team})),deck.cards.push(new Card({name:"Long Ranged",type:"companion",companion:"Hecate",team:this.team})),deck.cards.push(new Card({name:"Power +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.power20),team:this.team})),deck.cards.push(new Card({name:"Power +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.power20),team:this.team})),deck.cards.push(new Card({name:"Power +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.power20),team:this.team})),deck.cards.push(new Card({name:"Defense +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.defense20),team:this.team})),deck.cards.push(new Card({name:"Defense +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.defense20),team:this.team})),deck.cards.push(new Card({name:"Defense +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.defense20),team:this.team})),deck.cards.push(new Card({name:"Stability +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.stability20),team:this.team})),deck.cards.push(new Card({name:"Stability +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.stability20),team:this.team})),deck.cards.push(new Card({name:"Stability +20",type:"ability",ability:new Ability(VirtArenaControl.Abilities.stability20),team:this.team})),this.cardsInDeck=deck.cards},Deck.prototype.shuffle=function(){this.cardsInDeck.sort(function(a,b){return Math.floor(3*Math.random())-1})},Deck.prototype.drawCardsStartOfGame=function(){for(var i=0;2>i;i++){var card=this.cardsInDeck.shift();this.cardsInHand.push(card)}},Deck.prototype.drawCardsPhase=function(){var card=this.cardsInDeck.shift();this.cardsInHand.push(card)},Deck.prototype.updateCards=function(){for(var i in this.cardsInHand)this.cardsInHand[i].update({index:i,cardsInHand:this.cardsInHand.length,oddLength:this.cardsInHand.length%2})},Deck.prototype.graphicsDrawCards=function(){var delayedDraw=[];for(var i in this.cardsInHand)this.cardsInHand[i].hover?delayedDraw.push(this.cardsInHand[i]):this.cardsInHand[i].draw();
for(var i in delayedDraw)delayedDraw[i].draw()},Arturius.prototype=new Unit,Imperator.prototype=new Unit,Lancer.prototype=new Unit,Knight.prototype=new Unit,Praetorian.prototype=new Unit,Hecate.prototype=new Unit,function(){VirtArenaControl.Abilities={preemptiveStrike:{name:"Preemptive Strike",type:"attack",user:"ally",target:"self",desc:"+20 Power (doesn’t increase max attack) against Units that have not activated this turn.",keys:["power"],values:[20]},power20:{name:"Power +20",type:"attack",user:"ally",target:"self",desc:"+20 Power (doesn’t increase max attack) against Units that have not activated this turn.",keys:["power"],values:[20]},defense20:{name:"Defense +20",type:"defense",user:"ally",target:"ally",desc:"+20 Power (doesn’t increase max attack) against Units that have not activated this turn.",keys:["defense"],values:[20]},stability20:{name:"Stability +20",type:"defense",user:"ally",target:"ally",desc:"+20 Power (doesn’t increase max attack) against Units that have not activated this turn.",keys:["stability"],values:[20]},doubleStrike:{name:"Double Strike",type:"attack",user:"arturius",desc:"+20 Power for its second attack this turn."},preparation:{name:"Preparation",type:"attack",user:"ally",target:"self",desc:"+20 Penetration next turn",keys:["power"],values:[20]},flash:{name:"Flash",type:"defense",user:"arturius",desc:"+40 Defense and +10 Deflect if Arturius has already activated this turn (1 turn cd)."},parry:{name:"Parry",type:"defense",user:"arturius",desc:"Make a Power Roll with Saber and reduce the attack’s Power by the result."},reinforce:{name:"Reinforce",type:"defense",user:"ally",target:"self",desc:"+20 Defense and +40 Stability."},chargedShot:{name:"Charged Shot",type:"turn",user:"arturius",desc:"Arturius has -2 Move, Heavy Plasma Rifle gains Blast, and Fusion Tokens grant +10 Power per 2 tokens anted but do not grant Speed."},riposte:{name:"Riposte",type:"defense",user:"ally",target:"self",desc:"+20 Defense. After resolving the attack, make a Power 30 Penetration 80 attack against the attacker if it’s within Range 1."}},VirtArenaControl.Abilities.summonCompanion=function(tile){VirtArenaControl.TurnController.currentAbility.misc.team.addCompanion(VirtArenaControl.TurnController.currentAbility.misc.companion,tile),VirtArenaControl.TurnController.currentAbility.misc.team.cardUsed(VirtArenaControl.TurnController.currentAbility.card),VirtArenaControl.TurnController.resetCurrentAbility()},VirtArenaControl.Abilities.useAttackAbility=function(target){target.addAttackAbility(VirtArenaControl.TurnController.currentAbility.misc.ability),VirtArenaControl.TurnController.currentAbility.misc.team.cardUsed(VirtArenaControl.TurnController.currentAbility.card),VirtArenaControl.TurnController.resetCurrentAbility()},VirtArenaControl.Abilities.useDefenseAbility=function(target){target.addDefenseAbility(VirtArenaControl.TurnController.currentAbility.misc.ability),VirtArenaControl.TurnController.currentAbility.misc.team.cardUsed(VirtArenaControl.TurnController.currentAbility.card),VirtArenaControl.TurnController.resetCurrentAbility()}}(),function(){VirtArenaControl.ObjectController.unitMovement=function(unit,endTile,playerType){VirtArenaControl.ObjectController.unitMoving=!0,unit.moving=!0,VirtArenaControl.ObjectController.path=VirtArenaControl.ObjectController.findMovementPath(unit,endTile),endTile.moveCost<=unit.turnStats.move&&VirtArenaControl.ObjectController.stepMovement(unit,VirtArenaControl.ObjectController.path,playerType)},VirtArenaControl.ObjectController.findMovementPath=function(unit,endTile){var initialTile=unit.tile,error=(VirtArenaControl.Board.tiles,0);this.setTileMoveCosts(unit);for(var path=[],step=endTile;step!=initialTile&&100>error;)error++,path.unshift(step),step=step.parentTile;return path},VirtArenaControl.ObjectController.stepMovement=function(unit,path,playerType){var nextTile=path.shift();this.setUnitTile(unit,nextTile),unit.turnStats.move-=nextTile.moveCost,this.setTileMoveCosts(unit),VirtArenaControl.ObjectController.setTileRangeForWeapons(unit),path.length>0?setTimeout(function(){VirtArenaControl.ObjectController.stepMovement(unit,path,playerType)},this.movementStepDelay):VirtArenaControl.ObjectController.endMovement(playerType)},VirtArenaControl.ObjectController.endMovement=function(playerType){VirtArenaControl.ObjectController.unitMoving=!1,VirtArenaControl.Units.currentUnitActivating.moving=!1,"ai"===playerType&&(VirtArenaControl.Units.currentUnitActivating.ai.hasMoved=!0,VirtArenaControl.AI.Scripts.aiActivationControl(VirtArenaControl.Units.currentUnitActivating))},VirtArenaControl.ObjectController.setTileMoveCosts=function(unit){var initialTile=unit.tile,tiles=VirtArenaControl.Board.tiles,openTiles=[],blockedTiles=[],closedTiles=[],moveCost=1;for(var i in initialTile.adjacentTiles){var index=initialTile.adjacentTiles[i];tiles[index].isOpen()?(tiles[index].parentTile=initialTile,tiles[index].moveCost=moveCost,openTiles.push(tiles[index])):(tiles[index].parentTile=initialTile,tiles[index].moveCost=moveCost,blockedTiles.push(tiles[index]))}for(var error=0;1e3>error&&openTiles.length>0;){error++;for(var i=0;i<openTiles.length;i++){var nextMoveCost=openTiles[i].moveCost+1;for(var j in openTiles[i].adjacentTiles){var index=openTiles[i].adjacentTiles[j],indexInOpenTiles=openTiles.indexOf(tiles[index]);-1===indexInOpenTiles&&tiles[index].isOpen()?(tiles[index].parentTile=openTiles[i],tiles[index].moveCost=nextMoveCost,openTiles.push(tiles[index])):-1!=indexInOpenTiles&&openTiles[indexInOpenTiles].moveCost>nextMoveCost?(openTiles[indexInOpenTiles].parentTile=openTiles[i],openTiles[indexInOpenTiles].moveCost=nextMoveCost):tiles[index].isOpen()||(-1===blockedTiles.indexOf(tiles[index])?(tiles[index].parentTile=openTiles[i],tiles[index].moveCost=nextMoveCost,blockedTiles.push(tiles[index])):tiles[index].moveCost>nextMoveCost&&(tiles[index].parentTile=openTiles[i],tiles[index].moveCost=nextMoveCost))}closedTiles.push(openTiles[i])}for(var i=0;i<closedTiles.length;i++){var index=openTiles.indexOf(closedTiles[i]);-1!=index&&openTiles.splice(index,1)}}}}(),function(){VirtArenaControl.ObjectController.checkUsableWeapons=function(unit){var keys=Object.keys(unit.weapons),unitsInRange={},hasWeaponInRange=!1;for(var i in keys){unitsInRange[keys[i]]=VirtArenaControl.ObjectController.getUnitsInRange(unit,unit.weapons[keys[i]]);var outOfRange=unitsInRange[keys[i]].length>0?!1:!0;outOfRange||(hasWeaponInRange=!0)}return hasWeaponInRange},VirtArenaControl.ObjectController.addWeaponSelectionButtons=function(unit){var keys=Object.keys(unit.weapons),unitsInRange={};for(var i in keys){unitsInRange[keys[i]]=VirtArenaControl.ObjectController.getUnitsInRange(unit,unit.weapons[keys[i]]);var outOfRange=unitsInRange[keys[i]].length>0?!1:!0;VirtArenaControl.Buttons.addButton("selectWeapon",{unit:unit,weapon:unit.weapons[keys[i]],disabled:outOfRange,index:i,buttonsOfThisType:keys.length})}},VirtArenaControl.ObjectController.selectWeapon=function(unit,weapon){unit.setWeapon(weapon.number)},VirtArenaControl.ObjectController.setTileRangeForWeapons=function(unit){var initialTile=unit.tile,tiles=VirtArenaControl.Board.tiles,openTiles=[],closedTiles=[],rangeForWeapon=1;for(var i in initialTile.adjacentTiles){var index=initialTile.adjacentTiles[i];tiles[index].parentTile=initialTile,tiles[index].rangeForWeapon=rangeForWeapon,openTiles.push(tiles[index])}for(var error=0;1e3>error&&openTiles.length>0;){error++;for(var i=0;i<openTiles.length;i++){var nextRangeForWeapon=openTiles[i].rangeForWeapon+1;for(var j in openTiles[i].adjacentTiles){var index=openTiles[i].adjacentTiles[j],indexInOpenTiles=openTiles.indexOf(tiles[index]);-1===indexInOpenTiles?(tiles[index].parentTile=openTiles[i],tiles[index].rangeForWeapon=nextRangeForWeapon,openTiles.push(tiles[index])):openTiles[indexInOpenTiles].rangeForWeapon>nextRangeForWeapon&&(openTiles[indexInOpenTiles].parentTile=openTiles[i],openTiles[indexInOpenTiles].rangeForWeapon=nextRangeForWeapon)}closedTiles.push(openTiles[i])}for(var i=0;i<closedTiles.length;i++){var index=openTiles.indexOf(closedTiles[i]);-1!=index&&openTiles.splice(index,1)}}},VirtArenaControl.ObjectController.unitAttackSelectTarget=function(unitAttacking,unitTarget){var range=unitTarget.tile.rangeForWeapon;range>unitAttacking.getWeaponRange()?console.log("OUTOFRANGE: "+unitTarget.name,tile):(unitAttacking.team.aiTeam||VirtArenaControl.ObjectController.addWeaponSelectionButtons(unitAttacking),VirtArenaControl.TurnController.setCurrentAction("attack",{attackingUnit:unitAttacking,targetUnit:unitTarget,range:range}))},VirtArenaControl.ObjectController.unitAttackTarget=function(unit,target){var obj=unit.getDamageAndStatsForAttacking();target.takeDamage(obj),VirtArenaControl.ObjectController.attackResolved(unit,target)},VirtArenaControl.ObjectController.attackResolved=function(unit,target){unit.hasAttacked=!0,VirtArenaControl.Buttons.removeButton("selectWeapon"),VirtArenaControl.ObjectController.endAttackSubphase()},VirtArenaControl.ObjectController.endAttackSubphase=function(){VirtArenaControl.Buttons.removeButton("selectWeapon"),VirtArenaControl.TurnController.resetCurrentAction(),VirtArenaControl.TurnController.delayPhaseChange()},VirtArenaControl.ObjectController.getUnitsInRange=function(unit,weapon){var range=weapon.range,units=VirtArenaControl.Units.units,unitsInRange=[];for(var i in VirtArenaControl.Units.units)units[i].team!=unit.team&&units[i].tile.rangeForWeapon<=range&&unitsInRange.push(units[i]);return unitsInRange}}(),function(){VirtArenaControl.Board={x:0,y:0,width:0,height:0,horizontalPadding:200,topPadding:90,bottomPadding:150,tilesCount:0,rows:0,columns:0,tileWidth:51,tileHeight:51,tileSpacing:5,tiles:[],init:function(){this.rows=9,this.columns=12,this.oddRows=Math.floor(this.rows/2),this.tilesCount=this.rows*this.columns+this.oddRows,this.setupTiles(),this.width=(this.columns+1)*this.tileWidth+this.columns*this.tileSpacing+2*this.horizontalPadding,this.height=this.rows*this.tileHeight+this.rows*this.tileSpacing+this.topPadding+this.bottomPadding},drawBackground:function(){VirtArenaControl.Graphics.ctx.fillStyle="#ebf5f7",VirtArenaControl.Graphics.fillRectWithShadow(this.x,this.y,this.width,this.height,"#111",20,0,15),VirtArenaControl.Graphics.ctx.fillStyle="#ffffff",VirtArenaControl.Graphics.ctx.fillRect(this.x+this.horizontalPadding/2,this.y,this.width-this.horizontalPadding,this.height),VirtArenaControl.Graphics.ctx.drawImage(VirtArenaControl.Images.boardBackground,this.x,this.y,this.width,this.height)},drawCurrentPhase:function(){VirtArenaControl.Graphics.ctx.textAlign="center",VirtArenaControl.Graphics.ctx.fillStyle="#ffffff",VirtArenaControl.Graphics.ctx.font="16px Arial",VirtArenaControl.Graphics.ctx.fillText(VirtArenaControl.TurnController.getCurrentPhaseText(),this.x+this.width/2,this.y+this.topPadding/2)},updatePosition:function(){var oldX=this.x,oldY=this.y;this.x=Math.floor(VirtArenaControl.Camera.width/2-this.width/2),this.y=Math.floor(VirtArenaControl.Camera.y),(this.x!=oldX||this.y!=oldY)&&this.resetTilePositions()},setupTiles:function(){for(var dimensions={width:this.tileWidth,height:this.tileHeight,spacing:this.tileSpacing},i=0;i<this.rows;i++)for(var j=0;j<this.columns;j++){var newTile=new Tile(i,j,dimensions);if(newTile.index=this.tiles.length,this.tiles.push(newTile),i%2===1&&j===this.columns-1){var newTile=new Tile(i,j+1,dimensions);newTile.index=this.tiles.length,this.tiles.push(newTile)}}this.setAdjacentTiles()},setAdjacentTiles:function(){for(var i=0;i<this.tilesCount;i++){var tile=this.tiles[i];tile.oddRow?(tile.column!=this.columns&&(tile.adjacentTiles.push(i+1),0!=tile.row&&tile.adjacentTiles.push(i-this.columns),tile.row!=this.rows-1&&tile.adjacentTiles.push(i+this.columns+1)),0!=tile.column&&(tile.adjacentTiles.push(i-1),0!=tile.row&&tile.adjacentTiles.push(i-this.columns-1),tile.row!=this.rows-1&&tile.adjacentTiles.push(i+this.columns))):tile.oddRow||(tile.column!=this.columns-1&&tile.adjacentTiles.push(i+1),0!=tile.column&&tile.adjacentTiles.push(i-1),0!=tile.row&&(tile.adjacentTiles.push(i-this.columns-1),tile.adjacentTiles.push(i-this.columns)),tile.row!=this.rows-1&&(tile.adjacentTiles.push(i+this.columns+1),tile.adjacentTiles.push(i+this.columns)))}},resetTilePositions:function(){for(var i in this.tiles)this.tiles[i].setPositionOnBoardChange()}}}(),function(){VirtArenaControl.Graphics.draw=function(){for(var i=0;i<this.drawFunctions.length;i++)this[this.drawFunctions[i]]()},VirtArenaControl.Graphics.redrawCanvas=function(){this.ctx.textAlign="center",this.ctx.fillStyle="#444",VirtArenaControl.Graphics.ctx.lineWidth=1,VirtArenaControl.Graphics.ctx.textBaseline="middle",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)},VirtArenaControl.Graphics.drawSquare=function(){this.ctx.fillStyle="black",this.ctx.fillRect(VirtArenaControl.Camera.x,VirtArenaControl.Camera.y,VirtArenaControl.Camera.width/2,VirtArenaControl.Camera.height/2)},VirtArenaControl.Graphics.drawBoardTiles=function(){for(var tiles=VirtArenaControl.Board.tiles,i=0;i<tiles.length;i++)tiles[i].hover||tiles[i].unit&&tiles[i].unit.avatar.hover?tiles[i].drawHover():tiles[i].draw(),tiles[i].unit&&tiles[i].unit===VirtArenaControl.Units.currentUnitActivating&&tiles[i].drawBorderForActivatingUnit(),"movement"===tiles[i].targetFor&&tiles[i].drawHighlightForMovement(),"attack"===tiles[i].targetFor&&tiles[i].drawHighlightForAttack(),"attackConfirm"===tiles[i].targetFor&&tiles[i].drawHighlightForAttackConfirm(),"ability"===tiles[i].targetFor&&tiles[i].drawHighlightForAbility()},VirtArenaControl.Graphics.drawButtons=function(){for(var buttons=VirtArenaControl.Buttons.buttonsToDraw,i=0;i<buttons.length;i++){var button=VirtArenaControl.Buttons[buttons[i]];button&&button.draw()}},VirtArenaControl.Graphics.drawUnits=function(){var units=VirtArenaControl.Units.getUnitsToDraw();for(var i in units){var unit=units[i];unit&&!unit.dontDraw&&unit.draw()}},VirtArenaControl.Graphics.drawPath=function(){var path=VirtArenaControl.ObjectController.path;for(var i in path)path[i].drawPath()},VirtArenaControl.Graphics.drawBoardBackground=function(){VirtArenaControl.Board.drawBackground()},VirtArenaControl.Graphics.drawPlayerCards=function(){var deck;VirtArenaControl.Units.teams.blueTeam&&(deck=VirtArenaControl.Units.teams.blueTeam.deck),deck&&deck.graphicsDrawCards()},VirtArenaControl.Graphics.drawActivationOrder=function(){for(var i in VirtArenaControl.Units.activationOrder)VirtArenaControl.Units.activationOrder[i].avatar.draw()},VirtArenaControl.Graphics.drawTooltips=function(){for(var i in VirtArenaControl.Tooltips.tooltips)VirtArenaControl.Tooltips.tooltips[i].draw()},VirtArenaControl.Graphics.drawCurrentPhase=function(){VirtArenaControl.Board.drawCurrentPhase()}}(),function(){var images=VirtArenaControl.Images;images.boardBackground=new Image,images.boardBackground.src="assets/images/background.jpg",images.spritesheet={},images.spritesheet.image=new Image,images.spritesheet.image.src="assets/images/spritesheet2.png",images.spritesheet.cellWidth=40,images.spritesheet.cellHeight=40,images.imperatorUnitArt={x:0,y:0},images.arturiusUnitArt={x:160,y:0},images.lancerUnitArt={x:320,y:0},images.knightUnitArt={x:480,y:0},images.praetorianUnitArt={x:640,y:0},images.hecateUnitArt={x:800,y:0},images.stanceButtons={left:new Image,leftHover:new Image,middle:new Image,middleHover:new Image,right:new Image,rightHover:new Image},images.stanceButtons.left.src="assets/images/interface/stanceLeft2.png",images.stanceButtons.leftHover.src="assets/images/interface/stanceLeftHover.png",images.stanceButtons.middle.src="assets/images/interface/stanceMiddle.png",images.stanceButtons.middleHover.src="assets/images/interface/stanceMiddleHover.png",images.stanceButtons.right.src="assets/images/interface/stanceRight2.png",images.stanceButtons.rightHover.src="assets/images/interface/stanceRightHover.png",images.cardBackground=new Image,images.cardBackground.src="assets/images/interface/cardBackground.png"}(),function(){VirtArenaControl.Buttons.buttonsToDraw=["startGame","endPhase"],VirtArenaControl.Buttons.startGame=new Button,VirtArenaControl.Buttons.endPhase=new Button,VirtArenaControl.Buttons.init=function(){this.startGame.init(startGameInit()),this.endPhase.init(endPhaseInit())},VirtArenaControl.Buttons.addButton=function(buttonType,misc){"selectCommander"===buttonType?addSelectCommanderButtons(misc):"selectStances"===buttonType?addSelectStanceButtons(misc):"selectWeapon"===buttonType&&addSelectWeaponButton(misc)},VirtArenaControl.Buttons.removeButton=function(buttonType,misc){var buttons=Object.keys(this),buttonsToRemove=[];switch(buttonType){case"selectCommander":for(var i in buttons)-1!=buttons[i].indexOf("selectCommander")&&buttonsToRemove.push(buttons[i]);break;case"selectStance":for(var i in buttons)-1!=buttons[i].indexOf("selectStance")&&buttonsToRemove.push(buttons[i]);break;case"selectWeapon":for(var i in buttons)-1!=buttons[i].indexOf("selectWeapon")&&buttonsToRemove.push(buttons[i]);break;case"startGame":for(var i in buttons)-1!=buttons[i].indexOf("startGame")&&buttonsToRemove.push(buttons[i])}for(var i in buttonsToRemove){var index=this.buttonsToDraw.indexOf(buttonsToRemove[i]);index>=0&&this.buttonsToDraw.splice(index,1)}};var startGameInit=function(){var obj={};return obj.key="startGame",obj.text="Start Game",obj.width=100,obj.height=40,obj.x=.5*VirtArenaControl.Camera.width-obj.width/2,obj.y=VirtArenaControl.Camera.height-20-this.height,obj.onClick=function(){VirtArenaControl.TurnController.gameStarter.startGame()},obj.update=function(){this.x=.5*VirtArenaControl.Camera.width-this.width/2,this.y=VirtArenaControl.Camera.height-20-this.height},obj},endPhaseInit=function(){var obj={};return obj.key="endPhase",obj.text="Continue",obj.width=100,obj.height=40,obj.x=VirtArenaControl.Board.x+VirtArenaControl.Board.width-obj.width-20,obj.y=VirtArenaControl.Board.y+VirtArenaControl.Board.height/2-obj.height,obj.onClick=function(){this.disabled||VirtArenaControl.TurnController.endPhaseEarly()},obj.disabled=!1,obj.update=function(){this.x=VirtArenaControl.Board.x+VirtArenaControl.Board.width-this.width-20,this.y=VirtArenaControl.Board.y+VirtArenaControl.Board.height/2-this.height,this.disabled=VirtArenaControl.TurnController.delayingPhaseChange||VirtArenaControl.ObjectController.unitMoving||!("unitActivation"==VirtArenaControl.TurnController.currentPhase||"selectStances"==VirtArenaControl.TurnController.currentSubphase&&VirtArenaControl.Units.teams.blueTeam.allStancesSelected())||VirtArenaControl.Units.currentUnitActivating&&VirtArenaControl.Units.currentUnitActivating.team.aiTeam||"nextUnitActivation"==VirtArenaControl.TurnController.currentSubphase||"endActivation"==VirtArenaControl.TurnController.currentSubphase?!0:!1},obj},addSelectCommanderButtons=function(misc){var obj=VirtArenaControl.Units;for(var i in obj.chooseVirtCommanderVirts){var unitName=obj.chooseVirtCommanderVirts[i],buttonName="selectCommander"+unitName;VirtArenaControl.Buttons[buttonName]=new Button;var variablesForButton={key:buttonName,text:unitName,x:600,y:100+50*i,width:100,height:40,onClick:function(){VirtArenaControl.ObjectController.selectCommanderUnit(this.unit,this.team)},update:function(){this.x=VirtArenaControl.Camera.width-20-this.width,this.y=100+50*this.orderOfButtons},orderOfButtons:i,unit:unitName,team:misc.team};VirtArenaControl.Buttons[buttonName].init(variablesForButton),VirtArenaControl.Buttons.buttonsToDraw.push(buttonName)}},addSelectStanceButtons=function(misc){var units=misc.team.units;for(var j in units){var unit=units[j],keys=unit.dontDraw?[]:Object.keys(unit.stances);for(var i in keys){var buttonName=(unit.stances[keys[i]],"selectStance"+j+keys[i]);VirtArenaControl.Buttons[buttonName]=new Button;var variablesForButton={key:buttonName,text:"",x:-999,y:-999,width:20,height:20,radius:10,circle:!0,animateFrames:5,onClick:function(){this.disabled||VirtArenaControl.ObjectController.setUnitStance(this.unit,parseInt(this.index)+1)},update:function(){var startX=this.buttonsOfThisType%2?-(this.buttonsOfThisType/2*this.width+this.spacing):-(this.buttonsOfThisType/2*this.width+this.spacing/2),dynamicX=startX+this.index*(this.width+this.spacing),startY=this.buttonsOfThisType%2?Math.abs((this.buttonsOfThisType-1)/2-this.index)*-(.6*this.height):Math.floor(Math.abs((this.buttonsOfThisType-1)/2-this.index))*-(.6*this.height)-.2*this.height;this.x=this.unit.tile.x+this.unit.tile.width/2+dynamicX,this.y=this.unit.tile.y+this.unit.tile.height+startY,this.hoverVars.maxRadius=Math.floor(1.5*this.radius),this.selectedVars.maxRadius=Math.floor(1.5*this.radius),this.hover?0==this.hoverVars.radius?this.hoverVars.radius=this.radius:this.hoverVars.radius<this.hoverVars.maxRadius?this.hoverVars.radius+=(this.hoverVars.maxRadius-this.radius)/this.animateFrames:this.hoverVars.radius>this.hoverVars.maxRadius&&(this.hoverVars.radius=this.hoverVars.maxRadius):this.hoverVars.radius>0&&(this.hoverVars.radius=0),this.unit.stanceSelected===this.stance?(this.selected=!0,this.selectedVars.radius=this.selectedVars.maxRadius):this.selected&&(this.selected=!1)},spacing:1,index:i,buttonsOfThisType:keys.length,indexInUnitArray:j,disabled:unit.lastStanceSelected===keys[i]?!0:!1,unit:unit,stance:keys[i],hasTooltip:!0,getTooltip:function(){var obj={x:this.x+this.width/2,y:this.y,title:this.unit.stances[this.stance].name,subtitle:"stance",key:this.key,type:"button",subtype:"stance",obj:this.unit.stances[this.stance]};return obj}};0==variablesForButton.index?(variablesForButton.image=VirtArenaControl.Images.stanceButtons.left,variablesForButton.imageHover=VirtArenaControl.Images.stanceButtons.leftHover):1==variablesForButton.index&&variablesForButton.buttonsOfThisType>2?(variablesForButton.image=VirtArenaControl.Images.stanceButtons.middle,variablesForButton.imageHover=VirtArenaControl.Images.stanceButtons.middleHover):1==variablesForButton.index&&2==variablesForButton.buttonsOfThisType?(variablesForButton.image=VirtArenaControl.Images.stanceButtons.right,variablesForButton.imageHover=VirtArenaControl.Images.stanceButtons.rightHover):2==variablesForButton.index&&variablesForButton.buttonsOfThisType>2&&(variablesForButton.image=VirtArenaControl.Images.stanceButtons.right,variablesForButton.imageHover=VirtArenaControl.Images.stanceButtons.rightHover),VirtArenaControl.Buttons[buttonName].init(variablesForButton),VirtArenaControl.Buttons.buttonsToDraw.push(buttonName)}}},addSelectWeaponButton=function(misc){var unit=misc.unit,weapon=misc.weapon,buttonName="selectWeapon"+weapon.name;VirtArenaControl.Buttons[buttonName]=new Button;var variablesForButton={key:buttonName,text:weapon.name,x:-999,y:-999,width:20,height:20,radius:10,circle:!0,animateFrames:5,onClick:function(){this.disabled||VirtArenaControl.ObjectController.selectWeapon(this.unit,this.weapon)},update:function(){var startX=this.buttonsOfThisType%2?-(this.buttonsOfThisType/2*this.width+this.spacing):-(this.buttonsOfThisType/2*this.width+this.spacing/2),dynamicX=startX+this.index*(this.width+this.spacing),startY=this.buttonsOfThisType%2?Math.abs((this.buttonsOfThisType-1)/2-this.index)*-(.6*this.height):Math.floor(Math.abs((this.buttonsOfThisType-1)/2-this.index))*-(.6*this.height)-.2*this.height;this.x=this.unit.tile.x+this.unit.tile.width/2+dynamicX,this.y=this.unit.tile.y+this.unit.tile.height+startY,this.hoverVars.maxRadius=Math.floor(1.5*this.radius),this.selectedVars.maxRadius=Math.floor(1.5*this.radius),this.hover?0==this.hoverVars.radius?this.hoverVars.radius=this.radius:this.hoverVars.radius<this.hoverVars.maxRadius?this.hoverVars.radius+=(this.hoverVars.maxRadius-this.radius)/this.animateFrames:this.hoverVars.radius>this.hoverVars.maxRadius&&(this.hoverVars.radius=this.hoverVars.maxRadius):this.hoverVars.radius>0&&(this.hoverVars.radius=0),this.unit.stanceSelected===this.stance?(this.selected=!0,this.selectedVars.radius=this.selectedVars.maxRadius):this.selected&&(this.selected=!1)},spacing:5,index:misc.index,buttonsOfThisType:misc.buttonsOfThisType,disabled:misc.disabled,unit:unit,weapon:weapon,hasTooltip:!0,getTooltip:function(){var obj={x:this.x+this.width/2,y:this.y,title:this.weapon.name,subtitle:"weapon",key:this.key,type:"button",subtype:"weapon",obj:this.weapon};return obj}};VirtArenaControl.Buttons[buttonName].init(variablesForButton),VirtArenaControl.Buttons.buttonsToDraw.push(buttonName)}}(),function(){VirtArenaControl.Tooltips.tooltips=[],VirtArenaControl.Tooltips.newTooltip=function(obj,hoverObject){var hoverObject=hoverObject||obj,tooltip=new Tooltip(obj.getTooltip(),hoverObject);return this.tooltips.push(tooltip),tooltip},VirtArenaControl.Tooltips.tooltipExists=function(tooltipType,tooltipIdentifier){var exists=!1;for(var i in VirtArenaControl.Tooltips.tooltips){var tooltip=VirtArenaControl.Tooltips.tooltips[i];tooltip.type===tooltipType&&tooltip.id===tooltipIdentifier&&(exists=!0)}return exists},VirtArenaControl.Tooltips.removeTooltip=function(tooltipToRemove){var index=-1;for(var i in VirtArenaControl.Tooltips.tooltips){var tooltip=VirtArenaControl.Tooltips.tooltips[i];tooltip===tooltipToRemove&&(index=i)}index>=0&&VirtArenaControl.Tooltips.tooltips.splice(index,1)},VirtArenaControl.Tooltips.checkButtonTooltip=function(button){button&&button.hasTooltip&&!VirtArenaControl.Tooltips.tooltipExists("button",button.key)&&VirtArenaControl.Tooltips.newTooltip(button)}}(),function(){VirtArenaControl.Avatars.avatars=[],VirtArenaControl.Avatars.newAvatar=function(unit){var avatar=new Avatar({unit:unit});return this.avatars.push(avatar),avatar}}(),function(){Tile.prototype.onClick=function(){VirtArenaControl.Units;if("spawnCompanion"===VirtArenaControl.TurnController.currentAbility.ability&&"ability"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name)VirtArenaControl.Abilities.summonCompanion(this);else if("attack"===VirtArenaControl.TurnController.currentAbility.ability&&"ability"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name)VirtArenaControl.Abilities.useAttackAbility(this.unit);else if("defense"===VirtArenaControl.TurnController.currentAbility.ability&&"ability"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name)VirtArenaControl.Abilities.useDefenseAbility(this.unit);else if("attack"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name){var unit=VirtArenaControl.Units.currentUnitActivating;VirtArenaControl.ObjectController.unitAttackSelectTarget(unit,this.unit)}else if("attackConfirm"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name){var unitAttacking=VirtArenaControl.TurnController.currentAction.user,unitTarget=VirtArenaControl.TurnController.currentAction.target;VirtArenaControl.ObjectController.unitAttackTarget(unitAttacking,unitTarget)}else if("movement"===this.targetFor&&"blueTeam"==VirtArenaControl.Units.currentUnitActivating.team.name){var unit=VirtArenaControl.Units.currentUnitActivating;VirtArenaControl.ObjectController.unitMovement(unit,this)}else""!=this.unit}}(),function(){VirtArenaControl.Listeners.jquery={init:function(){VirtArenaControl.Graphics.canvas.oncontextmenu=function(e){return!1},document.addEventListener("mousemove",function(e){VirtArenaControl.Mouse.x=e.clientX||e.pageX,VirtArenaControl.Mouse.y=e.clientY||e.pageY},!1),(NaN===VirtArenaControl.Mouse.x||NaN===VirtArenaControl.Mouse.y)&&(mouseInCanvas=!1),$("#canvas1").hover(function(){VirtArenaControl.Mouse.mouseInCanvas=!0},function(){VirtArenaControl.Mouse.mouseInCanvas=!1}),VirtArenaControl.Graphics.canvas.onmousedown=function(e){VirtArenaControl.Interaction.mouseDownHandler(e)},VirtArenaControl.Graphics.canvas.onmouseup=function(e){},$("body").on("keydown",VirtArenaControl.Interaction.keyDownHandler)}}}(),function(){VirtArenaControl.Interaction.keyDownHandler=function(e){e.keyCode?e.keyCode:e.which}}(),function(){VirtArenaControl.Interaction.mouseDownHandler=function(e){var hoveredObj=VirtArenaControl.Updater.hoveredObjects[0];0===e.button&&(hoveredObj?hoveredObj.onClick():VirtArenaControl.ObjectController.resetSelectedObject())}}(),function(){VirtArenaControl.Updater.gameUpdate=function(){for(var i=0;i<this.updateFunctions.length;i++)this[this.updateFunctions[i]]()},VirtArenaControl.Updater.checkCanvasSize=function(){(window.innerWidth!=VirtArenaControl.Graphics.canvas.width||window.innerHeight!=VirtArenaControl.Graphics.canvas.height)&&(VirtArenaControl.Graphics.canvas.width=window.innerWidth,VirtArenaControl.Graphics.canvas.height=window.innerHeight,VirtArenaControl.Camera.width=window.innerWidth,VirtArenaControl.Camera.height=window.innerHeight)},VirtArenaControl.Updater.animateSquare=function(){VirtArenaControl.Camera.y+=VirtArenaControl.Graphics.canvas.height/60,VirtArenaControl.Camera.y>VirtArenaControl.Graphics.canvas.height&&(VirtArenaControl.Camera.y=.8*-VirtArenaControl.Camera.height)},VirtArenaControl.Updater.getMousePosition=function(){var scrollOffsetTop=document.body.scrollTop,scrollOffsetLeft=document.body.scrollLeft,canvasOffset=$("#canvas1").offset();VirtArenaControl.Mouse.x=VirtArenaControl.Mouse.x-canvasOffset.left+scrollOffsetLeft+VirtArenaControl.Camera.x,VirtArenaControl.Mouse.y=VirtArenaControl.Mouse.y-canvasOffset.top+scrollOffsetTop+VirtArenaControl.Camera.y},VirtArenaControl.Updater.resetHoveredObjects=function(){VirtArenaControl.Board.tiles,VirtArenaControl.Buttons.buttonsToDraw;for(var i in this.hoveredObjects){var obj=this.hoveredObjects[i];"Tile"===obj.constructor.name?obj.hover=!1:"Button"===obj.constructor.name?obj.hover=!1:"Card"===obj.constructor.name?obj.hover=!1:"Avatar"===obj.constructor.name&&(obj.hover=!1)}this.hoveredObjects=[]},VirtArenaControl.Updater.getHoveredObjects=function(){var tiles=VirtArenaControl.Board.tiles,buttons=VirtArenaControl.Buttons.buttonsToDraw,avatars=VirtArenaControl.Avatars.avatars,cards={};VirtArenaControl.Units.teams.blueTeam&&VirtArenaControl.Units.teams.blueTeam.deck.cardsInHand&&(cards=VirtArenaControl.Units.teams.blueTeam.deck.cardsInHand),this.resetHoveredObjects();var objectIsHovered=!1;if(!objectIsHovered)for(var i=0;i<cards.length;i++){var card=cards[i];if(Scripts.mouseInObject(card)){objectIsHovered=!0,card.hover=!0,this.hoveredObjects.push(card);break}}if(!objectIsHovered)for(var i=0;i<buttons.length;i++){var button=VirtArenaControl.Buttons[buttons[i]];if(Scripts.mouseInObject(button)){objectIsHovered=!0,button.hover=!0,this.hoveredObjects.push(button),VirtArenaControl.Tooltips.checkButtonTooltip(button);break}}if(!objectIsHovered)for(var i=0;i<tiles.length;i++)if(Scripts.mouseInObject(tiles[i])){objectIsHovered=!0,tiles[i].hover=!0,this.hoveredObjects.push(tiles[i]),tiles[i].unit&&!VirtArenaControl.Tooltips.tooltipExists("unit",tiles[i].unit.id)&&VirtArenaControl.Tooltips.newTooltip(tiles[i].unit,tiles[i]);break}if(!objectIsHovered)for(var i=0;i<avatars.length;i++){var avatar=avatars[i];if(Scripts.mouseInObject(avatar)){objectIsHovered=!0,avatar.hover=!0,this.hoveredObjects.push(avatar);break}}},VirtArenaControl.Updater.updateTileVariables=function(){var tiles=VirtArenaControl.Board.tiles;for(var i in tiles)tiles[i].targetFor="","spawnCompanion"===VirtArenaControl.TurnController.currentAbility.ability&&tiles[i].range<=VirtArenaControl.TurnController.currentAbility.range&&tiles[i].isOpen()?tiles[i].targetFor="ability":"attack"===VirtArenaControl.TurnController.currentAbility.ability&&VirtArenaControl.TurnController.currentAbility.target==tiles[i].unit?tiles[i].targetFor="ability":"defense"===VirtArenaControl.TurnController.currentAbility.ability&&"ally"==VirtArenaControl.TurnController.currentAbility.target&&tiles[i].unit&&tiles[i].unit.team==VirtArenaControl.TurnController.currentAbility.misc.team?tiles[i].targetFor="ability":VirtArenaControl.Units.currentUnitActivating&&tiles[i].rangeForWeapon<=VirtArenaControl.Units.currentUnitActivating.getWeaponRange()&&tiles[i].unit&&tiles[i].unit.team!=VirtArenaControl.Units.currentUnitActivating.team&&"activateUnit"===VirtArenaControl.TurnController.currentSubphase&&"attack"!=VirtArenaControl.TurnController.currentAction.action&&!VirtArenaControl.Units.currentUnitActivating.hasAttacked?tiles[i].targetFor="attack":"activateUnit"===VirtArenaControl.TurnController.currentSubphase&&"attack"===VirtArenaControl.TurnController.currentAction.action&&tiles[i].unit==VirtArenaControl.TurnController.currentAction.target?tiles[i].targetFor="attackConfirm":"activateUnit"===VirtArenaControl.TurnController.currentSubphase&&0===VirtArenaControl.ObjectController.path.length&&tiles[i].moveCost<=VirtArenaControl.Units.currentUnitActivating.turnStats.move&&tiles[i].isOpen()&&(tiles[i].targetFor="movement");
},VirtArenaControl.Updater.checkUnitPositions=function(){var units=VirtArenaControl.Units.units,tiles=VirtArenaControl.Board.tiles,tilesWithUnits=[];for(var i in units)tilesWithUnits.push(units[i].tile.index);for(var i in tiles)""!=tiles[i].unit,""!=tiles[i].unit&&-1===tilesWithUnits.indexOf(tiles[i].index)&&(tiles[i].unit="")},VirtArenaControl.Updater.updateUnitAnimations=function(){var units=VirtArenaControl.Units.units;for(var i in units){units[i].checkCurrentAnimation();var animation=units[i].animation;animation.time=(animation.time+1)%animation[animation.current].duration,0===animation.time&&(animation.frame=(animation.frame+1)%animation[animation.current].frames)}},VirtArenaControl.Updater.updateButtonPositions=function(){var buttonsToDraw=VirtArenaControl.Buttons.buttonsToDraw;for(var i in buttonsToDraw)VirtArenaControl.Buttons[buttonsToDraw[i]].update()},VirtArenaControl.Updater.updateBoardPosition=function(){VirtArenaControl.Board.updatePosition()},VirtArenaControl.Updater.updateDeck=function(){var deck;VirtArenaControl.Units.teams.blueTeam&&(deck=VirtArenaControl.Units.teams.blueTeam.deck),deck&&deck.updateCards()},VirtArenaControl.Updater.updateActivationAvatars=function(){for(var i in VirtArenaControl.Avatars.avatars)VirtArenaControl.Avatars.avatars[i].update()},VirtArenaControl.Updater.updateTooltips=function(){for(var i in VirtArenaControl.Tooltips.tooltips)VirtArenaControl.Tooltips.tooltips[i].update()}}(),function(){VirtArenaControl.AI.Scripts.stanceSelection=function(team){for(var i in team.units)if(team.units[i].alive){var stance=this.aiSelectStance(team.units[i]);team.units[i].setStance(stance)}},VirtArenaControl.AI.Scripts.randomStance=function(virt){var stances=Object.keys(virt.stances),indexOfLastStanceSelected=stances.indexOf(virt.lastStanceSelected);-1!=indexOfLastStanceSelected&&stances.splice(indexOfLastStanceSelected,1);var random=Math.floor(Math.random()*stances.length);return stances[random]},VirtArenaControl.AI.Scripts.aiSelectStance=function(aiUnit){VirtArenaControl.ObjectController.setTileMoveCosts(aiUnit),VirtArenaControl.ObjectController.setTileRangeForWeapons(aiUnit);var chooseStance={stance1:aiUnit.stances.stance1?100:0,stance2:aiUnit.stances.stance2?100:0,stance3:aiUnit.stances.stance3?100:0};"stance1"===aiUnit.lastStanceSelected?chooseStance.stance1*=0:"stance2"===aiUnit.lastStanceSelected?chooseStance.stance2*=0:"stance3"===aiUnit.lastStanceSelected&&(chooseStance.stance3*=0),"Arturius"===aiUnit.unitType||"Imperator"===aiUnit.unitType||"Lancer"===aiUnit.unitType||"Praetorian"===aiUnit.unitType;for(var decisionValuesArray=[],i=1;4>i;i++)decisionValuesArray.push({stance:"stance"+i,value:chooseStance["stance"+i]});decisionValuesArray.sort(Scripts.sortStancesDescending);var stanceChosen=decisionValuesArray[0].stance;return stanceChosen}}(),function(){VirtArenaControl.AI.Scripts.getEnemyTeam=function(aiUnit){var teams=VirtArenaControl.Units.teams,team=aiUnit.team,keys=Object.keys(teams);for(var i in keys)if(teams[keys[i]].name!=team.name)return teams[keys[i]]},VirtArenaControl.AI.Scripts.getMoveDistanceFromUnits=function(aiUnit,units){VirtArenaControl.ObjectController.setTileMoveCosts(aiUnit);var moveDistance=[];for(var i in units){var obj={unit:units[i],moveDistance:units[i].tile.moveCost};moveDistance.push(obj)}return moveDistance.sort(function(a,b){return Scripts.sortAscending(a.moveDistance,b.moveDistance)}),moveDistance},VirtArenaControl.AI.Scripts.findClosestTileInMoveRange=function(unit,targetTile){var adjacentTilesInRange=(VirtArenaControl.Board.tiles,VirtArenaControl.AI.Scripts.getAdjacentTilesInRange(unit,targetTile));if(adjacentTilesInRange.length>0)return adjacentTilesInRange[0];var tilesClosestToTarget=VirtArenaControl.AI.Scripts.getTilesClosestToTargetInRange(unit,targetTile);return tilesClosestToTarget[0]?tilesClosestToTarget[0].tile:null},VirtArenaControl.AI.Scripts.getAdjacentTilesInRange=function(unit,targetTile){var tiles=VirtArenaControl.Board.tiles,adjacentTiles=[];for(var i in targetTile.adjacentTiles){var tile=tiles[targetTile.adjacentTiles[i]];tile.moveCost<=unit.turnStats.move&&tile.isOpen()&&adjacentTiles.push(tile)}return adjacentTiles.sort(function(a,b){return Scripts.sortAscending(a.moveCost,b.moveCost)}),adjacentTiles},VirtArenaControl.AI.Scripts.getTilesClosestToTargetInRange=function(unit,targetTile){var tiles=VirtArenaControl.Board.tiles,tilesInMoveRange=[];for(var i in tiles)if(tiles[i].moveCost<=unit.turnStats.move&&tiles[i].isOpen()){var range=Scripts.getMoveRangeBetweenTiles(tiles[i],targetTile);tilesInMoveRange.push({tile:tiles[i],range:range})}return tilesInMoveRange.sort(function(a,b){var rangeDifference=a.tile.moveCost+a.range-(b.tile.moveCost+b.range);return 0===rangeDifference&&(rangeDifference=b.tile.moveCost-a.tile.moveCost),rangeDifference}),tilesInMoveRange},VirtArenaControl.AI.Scripts.findUnitsInRangeOfWeapons=function(aiUnit){var weaponsKeys=(VirtArenaControl.Units.units,Object.keys(aiUnit.weapons)),unitsInRange=[];for(var i in weaponsKeys){var unitsInRange=VirtArenaControl.AI.Scripts.orderUnitsInRange(aiUnit,aiUnit.weapons[weaponsKeys[i]]);for(var j in unitsInRange)unitsInRange[j]={unit:unitsInRange[j],weapon:aiUnit.weapons[weaponsKeys[i]]}}return unitsInRange},VirtArenaControl.AI.Scripts.orderUnitsInRange=function(aiUnit,weapon){var unitsInRange=VirtArenaControl.ObjectController.getUnitsInRange(aiUnit,weapon);return unitsInRange.sort(function(a,b){return a.hp-b.hp}),unitsInRange},VirtArenaControl.AI.Scripts.selectTarget=function(aiUnit,units,preferredTarget){var targets=[];return"mostVulnerable"===preferredTarget?(targets=VirtArenaControl.AI.Scripts.orderTargetUnitsByDamage(aiUnit,units),targets[0]?{unit:targets[0].unit,weapon:targets[0].weapon}:null):void 0},VirtArenaControl.AI.Scripts.orderTargetUnitsByDamage=function(aiUnit,units){return units.sort(function(a,b){var aPower=a.weapon.getPotentialPower(aiUnit,a.unit),bPower=b.weapon.getPotentialPower(aiUnit,b.unit),difference=bPower-aPower;return difference}),units},VirtArenaControl.AI.Scripts.determineActivationCardsToUse=function(aiUnit,enemyTeam){var cards=aiUnit.team.deck.cardsInHand,cardsToPlay=[];if(aiUnit.commander===!0)for(var i in cards){var cardToPlay=VirtArenaControl.AI.Scripts.checkCompanionCardPlayable(aiUnit,cards[i],cardsToPlay);cardToPlay&&cardsToPlay.push(cardToPlay)}return cardsToPlay},VirtArenaControl.AI.Scripts.checkCompanionCardPlayable=function(aiUnit,card,queuedCards){var tiles=VirtArenaControl.Board.tiles,cardReturnObj={card:card,target:"",action:"spawnCompanion"},playable=!1;if(card.companion)for(var i in aiUnit.tile.adjacentTiles){var path,tile=tiles[aiUnit.tile.adjacentTiles[i]];path=aiUnit.ai.hasMoved?!1:VirtArenaControl.ObjectController.findMovementPath(aiUnit,aiUnit.ai.targetTile);var tileInPath=path&&path.indexOf(tile)>=-1?!0:!1,tileUsed=VirtArenaControl.AI.Scripts.checkQueuedCardsForTileUsed(tile,queuedCards);!tile.isOpen()||tileInPath||tileUsed||(cardReturnObj.target=tile,playable=!0)}return playable?cardReturnObj:!1},VirtArenaControl.AI.Scripts.checkQueuedCardsForTileUsed=function(tile,queuedCards){for(var i in queuedCards)if(queuedCards[i].target===tile)return!0;return!1},VirtArenaControl.AI.Scripts.AISummonCompanion=function(aiUnit,cardObj){VirtArenaControl.TurnController.setCurrentAbility("spawnCompanion",{card:cardObj.card,team:aiUnit.team,companion:cardObj.card.companion}),setTimeout(function(){VirtArenaControl.Abilities.summonCompanion(cardObj.target),setTimeout(function(){VirtArenaControl.AI.Scripts.playCards(aiUnit)},VirtArenaControl.TurnController.phaseChangeDelay)},VirtArenaControl.TurnController.phaseChangeDelay)}}(),function(){VirtArenaControl.AI.Scripts.aiActivationControl=function(aiUnit){VirtArenaControl.ObjectController.setTileMoveCosts(aiUnit),VirtArenaControl.ObjectController.setTileRangeForWeapons(aiUnit);var aiObj={},enemyTeam={team:VirtArenaControl.AI.Scripts.getEnemyTeam(aiUnit)};enemyTeam.units=enemyTeam.team.units,enemyTeam.unitDistances=VirtArenaControl.AI.Scripts.getMoveDistanceFromUnits(aiUnit,enemyTeam.units),aiObj.state=VirtArenaControl.AI.Scripts.determineAIState(aiUnit,enemyTeam),aiUnit.ai.state=aiObj.state,aiObj.targets=VirtArenaControl.AI.Scripts.determineAITargetTile(aiUnit,enemyTeam,aiObj),aiUnit.ai.targetUnit=aiObj.targets.unit.unit,aiUnit.ai.targetTile=aiObj.targets.tile,aiObj.cardsToUse=VirtArenaControl.AI.Scripts.determineAIBoosts(aiUnit,enemyTeam),aiUnit.cardsToPlay=aiObj.cardsToUse,aiUnit.ai.hasMoved?aiUnit.ai.hasUsedCards?aiUnit.ai.hasAttacked||(VirtArenaControl.AI.Scripts.setWeaponAndTarget(aiUnit),setTimeout(function(){aiUnit.weaponSelected.name?VirtArenaControl.AI.Scripts.attackWithAI(aiUnit):VirtArenaControl.ObjectController.endAttackSubphase()},VirtArenaControl.TurnController.phaseChangeDelay)):VirtArenaControl.AI.Scripts.playCards(aiUnit):VirtArenaControl.AI.Scripts.moveAI(aiUnit)},VirtArenaControl.AI.Scripts.determineAIState=function(aiUnit,enemyTeam){var state="attackClosest";return state},VirtArenaControl.AI.Scripts.determineAITargetTile=function(aiUnit,enemyTeam,aiObj){var closestUnit=enemyTeam.unitDistances[0],tile=VirtArenaControl.AI.Scripts.findClosestTileInMoveRange(aiUnit,closestUnit.unit.tile);return{unit:closestUnit,tile:tile}},VirtArenaControl.AI.Scripts.determineAIBoosts=function(aiUnit,enemyTeam){if("activateUnit"===VirtArenaControl.TurnController.currentSubphase)var cardsToUse=VirtArenaControl.AI.Scripts.determineActivationCardsToUse(aiUnit,enemyTeam);return console.log("cardsToUse: ",cardsToUse),cardsToUse},VirtArenaControl.AI.Scripts.moveAI=function(aiUnit){aiUnit.ai.targetTile?VirtArenaControl.ObjectController.unitMovement(aiUnit,aiUnit.ai.targetTile,"ai"):VirtArenaControl.ObjectController.endMovement("ai")},VirtArenaControl.AI.Scripts.setWeaponAndTarget=function(aiUnit){var unitsInRange=VirtArenaControl.AI.Scripts.findUnitsInRangeOfWeapons(aiUnit),preferredTarget="mostVulnerable",select=VirtArenaControl.AI.Scripts.selectTarget(aiUnit,unitsInRange,preferredTarget);select&&(aiUnit.ai.targetUnit=select.unit,VirtArenaControl.ObjectController.selectWeapon(aiUnit,select.weapon))},VirtArenaControl.AI.Scripts.attackWithAI=function(aiUnit){VirtArenaControl.ObjectController.unitAttackSelectTarget(aiUnit,aiUnit.ai.targetUnit),setTimeout(function(){var unitAttacking=VirtArenaControl.TurnController.currentAction.user,unitTarget=VirtArenaControl.TurnController.currentAction.target;VirtArenaControl.ObjectController.unitAttackTarget(unitAttacking,unitTarget)},VirtArenaControl.TurnController.phaseChangeDelay)},VirtArenaControl.AI.Scripts.playCards=function(aiUnit){if(console.log(aiUnit),console.log("playCards: ",aiUnit.cardsToPlay.length),aiUnit.cardsToPlay.length>0){var cardObj=aiUnit.cardsToPlay.shift();"spawnCompanion"===cardObj.action&&VirtArenaControl.AI.Scripts.AISummonCompanion(aiUnit,cardObj)}else aiUnit.ai.hasUsedCards=!0,VirtArenaControl.AI.Scripts.aiActivationControl(aiUnit)}}();